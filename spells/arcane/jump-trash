#!/bin/sh

# This spell teleports you to your system trash directory.
# Source this file or use word-of-binding to invoke it.

jump_trash_usage() {
  cat <<'USAGE'
Usage: jump-trash

Teleport to your system trash directory.
USAGE
}

case "${1-}" in
--help|--usage|-h)
  jump_trash_usage
  exit 0
  ;;
esac

running_as_script=0
case $0 in
*/jump-trash|jump-trash)
  running_as_script=1
  set -eu
  . env-clear
  ;;
*) : ;;
esac

# The actual jump function that changes directory
jump_trash() {
  case "${1-}" in
  --help|--usage|-h)
    cat <<'USAGE'
Usage: jump-trash

Teleport to the system trash directory (macOS: ~/.Trash; Linux: ~/.local/share/Trash/files or $XDG_DATA_HOME/Trash/files).
USAGE
    return 0
    ;;
  esac

  # Inline get_trash_path - only used once
  if command -v detect-trash >/dev/null 2>&1; then
    trash_path=$(detect-trash)
  else
    # Inline fallback if detect-trash is not available
    platform=''
    if command -v detect-distro >/dev/null 2>&1; then
      platform=$(detect-distro 2>/dev/null || printf 'unknown')
    else
      kernel=$(uname -s 2>/dev/null || printf 'unknown')
      case "$kernel" in
      Darwin) platform='mac' ;;
      Linux) platform='linux' ;;
      *) platform='unknown' ;;
      esac
    fi
    
    case "$platform" in
    mac)
      trash_path="$HOME/.Trash"
      ;;
    *)
      xdg_data="${XDG_DATA_HOME:-$HOME/.local/share}"
      trash_path="$xdg_data/Trash/files"
      ;;
    esac
  fi
  
  if [ -z "$trash_path" ]; then
    return 1
  fi

  if [ ! -d "$trash_path" ]; then
    printf '%s\n' "jump-trash: trash directory does not exist: $trash_path" >&2
    printf '%s\n' "The trash may be empty or the directory has not been created yet." >&2
    return 1
  fi

  cd "$trash_path" || return 1
  printf '%s\n' "You teleport to the trash at $trash_path"
}

alias jump-trash=jump_trash 2>/dev/null || true

if [ "$running_as_script" -eq 1 ]; then
  # Inline jump_trash_cli logic - only used once
  case ${1-} in
  --help|--usage|-h)
    jump_trash_usage
    ;;
  "")
    jump_trash || true
    ;;
  *)
    printf '%s\n' "jump-trash: unknown option '$1'." >&2
    exit 1
    ;;
  esac
fi
