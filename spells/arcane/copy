#!/bin/sh

# This spell copies the text file at the specified path to the clipboard.
# It takes one argument, the path to the text file.

set -eu

show_usage() {
        cat <<'USAGE'
Usage: copy <file>

Copy the contents of the specified text file to the system clipboard using
pbcopy, xsel, or xclip. Prints a confirmation when successful.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

# Handle missing argument
if [ "$#" -eq 0 ]; then
    say 'That file does not exist.'
    exit 1
fi

is file "$1" || { say 'That file does not exist.'; exit 1; }

# Copy file contents to clipboard using the clip-copy imp
if ! clip-copy < "$1"; then
    warn 'Your spell fizzles. No clipboard utilities are available on this system. Please install xsel, xclip, or pbcopy (for mac)'
    exit 1
fi

# Normalize path for display
display_path=$(norm-path "$1")
say "Copied $display_path to your clipboard."
