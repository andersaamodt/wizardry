#!/bin/sh

# This spell displays the status of package managers on the system.
# Use it to see which package managers are available.

show_usage() {
        cat <<'USAGE'
Usage: package-managers

Display the status of package managers available on the system,
showing which ones are installed and available.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

set -eu

. colors

distro=$(detect-distro)

case $distro in
  "arch")
    if pacman -Q pacman >/dev/null 2>&1; then
        printf '%b✔ pacman%b (default package manager on Arch Linux)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ pacman%b (default package manager on Arch Linux)\n' "$RED" "$RESET"
    fi
    if yay -V >/dev/null 2>&1; then
        printf '%b✔ yay%b (AUR helper for Arch Linux)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ yay%b (AUR helper for Arch Linux)\n' "$RED" "$RESET"
    fi
    ;;
  "debian")
    if apt-get -v >/dev/null 2>&1; then
        printf '%b✔ apt%b (default package manager on Debian and Ubuntu)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ apt%b (default package manager on Debian and Ubuntu)\n' "$RED" "$RESET"
    fi
    ;;
  "fedora")
    if dnf --version >/dev/null 2>&1; then
        printf '%b✔ dnf%b (default package manager on Fedora)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ dnf%b (default package manager on Fedora)\n' "$RED" "$RESET"
    fi
    ;;
  "macos"|"mac")
    if brew --version >/dev/null 2>&1; then
        printf '%b✔ brew%b (default package manager on macOS)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ brew%b (default package manager on macOS)\n' "$RED" "$RESET"
    fi
    if port -v >/dev/null 2>&1; then
        printf '%b✔ port%b (MacPorts on macOS)\n' "$GREEN" "$RESET"
    else
        printf '%b✘ port%b (MacPorts on macOS)\n' "$RED" "$RESET"
    fi
    ;;
esac
