#!/bin/sh

# Run the POSIX compliance checker across wizardry spells from the system menu.

set -eu

script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd)
repo_dir=$(CDPATH= cd -- "$script_dir/../../.." && pwd)

PATH="$repo_dir/spells:$repo_dir/spells/system:$PATH"

cd "$repo_dir" || exit 1

if command -v verify-posix >/dev/null 2>&1; then
  exec verify-posix
fi

fallback="$repo_dir/spells/system/verify-posix"

if [ ! -x "$fallback" ]; then
  echo "system verify-posix: missing spell at $fallback" >&2
  exit 1
fi

exec "$fallback"
