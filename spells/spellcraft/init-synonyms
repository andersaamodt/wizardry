#!/bin/sh
# This spell initializes default built-in synonyms if they don't exist.
# Called automatically when accessing synonym features.

require-wizardry || exit 1

set -eu
. env-clear

spell_home=$(env-or SPELLBOOK_DIR "${HOME:-.}/.spellbook")
synonyms_file="$spell_home/.synonyms"

# Ensure synonyms file exists
if [ ! -f "$synonyms_file" ]; then
  cat > "$synonyms_file" << 'HEADER'
# Wizardry Synonyms
# This file contains shell aliases for wizardry spells.
# Loaded automatically by invoke-wizardry at shell startup.
# Reload with: . invoke-thesaurus

HEADER
fi

# Define default synonyms (word -> spell)
# Each line: synonym_word target_spell
default_synonyms="
detect-os detect-distro
home cd
"

# Install each default synonym if it doesn't exist
echo "$default_synonyms" | while IFS= read -r line; do
  # Skip empty lines
  [ -n "$line" ] || continue
  
  # Parse word and spell
  synonym_word=$(echo "$line" | awk '{print $1}')
  target_spell=$(echo "$line" | awk '{print $2}')
  
  # Skip if either is empty
  [ -n "$synonym_word" ] || continue
  [ -n "$target_spell" ] || continue
  
  # Only create if it doesn't exist
  if ! grep -q "^alias $synonym_word=" "$synonyms_file" 2>/dev/null; then
    # Add the alias to the file
    printf "alias %s='%s'\n" "$synonym_word" "$target_spell" >> "$synonyms_file"
  fi
done

# Mark that initialization has been done
touch "$spell_home/.synonyms-initialized" 2>/dev/null || :
