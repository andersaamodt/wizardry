#!/bin/sh
# require COMMAND [MESSAGE] - check if dependency is available, offer to install
# Delegates to require-command if available; falls back to simple command check.
# Example: require menu "The menu command is needed"
set -eu


req_tool=$1
shift

if [ -n "${REQUIRE_COMMAND-}" ]; then
  req_cmd=$REQUIRE_COMMAND
elif command -v require-command >/dev/null 2>&1; then
  req_cmd=require-command
elif command -v require_command >/dev/null 2>&1; then
  req_cmd=require_command
else
  req_cmd=""
fi

if [ -n "$req_cmd" ]; then
  "$req_cmd" "$req_tool" "$@"
  exit $?
fi

if command -v "$req_tool" >/dev/null 2>&1; then
  exit 0
fi
case $req_tool in
  *-*)
    req_alt=$(printf '%s' "$req_tool" | tr '-' '_')
    if command -v "$req_alt" >/dev/null 2>&1; then
  exit 0
    fi
    ;;
  *_*)
    req_alt=$(printf '%s' "$req_tool" | tr '_' '-')
    if command -v "$req_alt" >/dev/null 2>&1; then
  exit 0
    fi
    ;;
esac

if [ "$#" -gt 0 ]; then
  printf '%s\n' "$*" >&2
else
  printf '%s\n' "require: missing required command '$req_tool'" >&2
fi
printf '%s\n' "Visit 'install-menu' to review installation options." >&2
exit 1
