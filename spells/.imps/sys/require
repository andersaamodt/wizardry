#!/bin/sh
# require COMMAND [MESSAGE] - check if dependency is available, offer to install
# Delegates to require-command if available; falls back to simple command check.
# Example: require menu "The menu command is needed"
set -eu

_require() {
  _req_tool=$1
  shift

  if [ -n "${REQUIRE_COMMAND-}" ]; then
    _req_cmd=$REQUIRE_COMMAND
  elif command -v require-command >/dev/null 2>&1; then
    _req_cmd=require-command
  else
    _req_cmd=""
  fi

  if [ -n "$_req_cmd" ]; then
    "$_req_cmd" "$_req_tool" "$@"
    return $?
  fi

  if command -v "$_req_tool" >/dev/null 2>&1; then
    return 0
  fi

  if [ "$#" -gt 0 ]; then
    printf '%s\n' "$*" >&2
  else
    printf '%s\n' "require: missing required command '$_req_tool'" >&2
  fi
  printf '%s\n' "Visit 'install-menu' to review installation options." >&2
  return 1
}

# Self-execute when run directly (not sourced)
case "$0" in
  */require) [ "${_WIZARDRY_SOURCING:-}" != "1" ] && _require "$@" ;; esac
