#!/bin/sh
# env-or VAR DEFAULT - output env var value if set and non-empty, else default
# Example: dir=$(env-or SPELLBOOK_DIR "$HOME/.spellbook")
set -eu

_env_or() {
  _eo_var=$1
  # Validate variable name contains only alphanumerics and underscores
  case "$_eo_var" in
    *[!A-Za-z0-9_]*|"")
      printf '%s\n' "$2"
      return
      ;;
  esac
  eval "_eo_val=\${$_eo_var-}"
  if [ -n "$_eo_val" ]; then
    printf '%s\n' "$_eo_val"
  else
    printf '%s\n' "$2"
  fi
}

# Self-execute when run directly (not sourced)
case "$0" in
  */env-or) [ "${_WIZARDRY_SOURCING:-}" != "1" ] && _env_or "$@" ;; esac
