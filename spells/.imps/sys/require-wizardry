#!/bin/sh
# require-wizardry - check if wizardry is installed, exit 1 if not
# Returns 0 if wizardry is installed (menu spell found in PATH)
# Returns 1 if wizardry is not installed
# In test mode (WIZARDRY_TEST_HELPERS_ONLY=1), always returns 0
set -eu

_require_wizardry() {
  # In test mode, assume wizardry is available (tests set up their own PATH)
  if [ "${WIZARDRY_TEST_HELPERS_ONLY:-}" = "1" ]; then
    return 0
  fi
  
  # Check if wizardry is installed by looking for a core spell
  if has menu; then
    return 0
  else
    # Wizardry not found - print helpful error
    printf '%s\n' "Error: wizardry is not installed or not in PATH." >&2
    printf '%s\n' "" >&2
    printf '%s\n' "To install wizardry, run:" >&2
    printf '%s\n' "  curl -fsSL https://raw.githubusercontent.com/andersaamodt/wizardry/main/install | sh" >&2
    printf '%s\n' "" >&2
    printf '%s\n' "Or clone and install with git:" >&2
    printf '%s\n' "  git clone https://github.com/andersaamodt/wizardry ~/.wizardry" >&2
    printf '%s\n' "  cd ~/.wizardry && ./install" >&2
    return 1
  fi
}

# Self-execute when run directly (not sourced)
case "$0" in
  */require-wizardry) _require_wizardry "$@" ;; esac
