#!/bin/sh
# set-attribute KEY VALUE FILE - write the value of a specific extended attribute
# Tries attr, xattr, and setfattr in order
# Returns 0 if successfully written, 1 if all helpers failed
set -eu


key=$1
value=$2
file=$3

# Try attr first (Linux, simplest output)
if check-attribute-tool attr; then
  if attr -s "$key" -V "$value" "$file" 2>/dev/null; then
    exit 0
  fi
fi

# Try xattr (macOS)
if check-attribute-tool xattr; then
  if xattr -w "$key" "$value" "$file" 2>/dev/null; then
    exit 0
  fi
fi

# Try setfattr (Linux)
if check-attribute-tool setfattr; then
  if setfattr -n "$key" -v "$value" "$file" 2>/dev/null; then
    exit 0
  fi
fi

exit 1
