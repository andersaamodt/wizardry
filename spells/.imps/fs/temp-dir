#!/bin/sh
# temp-dir [PREFIX] - create temp directory with optional prefix (outputs path)
# Example: tmpdir=$(temp-dir myapp) && trap 'cleanup-dir "$tmpdir"' EXIT
set -eu


td_prefix=${1:-wizardry}
# Prefer WIZARDRY_TMPDIR if set and exists, otherwise use TMPDIR or /tmp
# This handles test environments where TMPDIR may point to sandbox dirs
if [ -n "${WIZARDRY_TMPDIR-}" ] && [ -d "$WIZARDRY_TMPDIR" ]; then
  mktemp -d "${WIZARDRY_TMPDIR}/${td_prefix}.XXXXXX"
elif [ -n "${TMPDIR-}" ] && [ -d "$TMPDIR" ]; then
  mktemp -d "${TMPDIR}/${td_prefix}.XXXXXX"
else
  mktemp -d "/tmp/${td_prefix}.XXXXXX"
fi
