#!/bin/sh
# temp-file [PREFIX] - create temp file with optional prefix (outputs path)
# Example: tmp=$(temp-file myapp) && trap 'cleanup-file "$tmp"' EXIT
set -eu

temp_file() {
  _tf_prefix=${1:-wizardry}
  # Prefer WIZARDRY_TMPDIR if set and exists, otherwise use TMPDIR or /tmp
  # This handles test environments where TMPDIR may point to sandbox dirs
  if [ -n "${WIZARDRY_TMPDIR-}" ] && [ -d "$WIZARDRY_TMPDIR" ]; then
    mktemp "${WIZARDRY_TMPDIR}/${_tf_prefix}.XXXXXX"
  elif [ -n "${TMPDIR-}" ] && [ -d "$TMPDIR" ]; then
    mktemp "${TMPDIR}/${_tf_prefix}.XXXXXX"
  else
    mktemp "/tmp/${_tf_prefix}.XXXXXX"
  fi
}

temp_file "$@"
