#!/bin/sh
# attr-tool-check HELPER - check if an xattr helper command is available and usable
# Returns 0 if helper is available, 1 otherwise
# Note: xattr commands (setfattr, getfattr, attr, xattr) are allowed even in test mode
# because they are essential platform tools, like coreutils
set -eu

helper=$1

if ! command -v "$helper" >/dev/null 2>&1; then
  exit 1
fi

# xattr commands are always allowed (they're platform tools, not wizardry helpers)
# This enables testing actual xattr functionality in CI
case "$helper" in
  setfattr|getfattr|attr|xattr)
    exit 0
    ;;
esac

# For non-xattr commands, respect test mode
if [ "${WIZARDRY_TEST_HELPERS_ONLY:-0}" = "1" ]; then
  # In test mode, reject system commands (those in standard system paths)
  helper_path=$(command -v "$helper")
  case "$helper_path" in
    /bin/*|/usr/bin/*|/sbin/*|/usr/sbin/*|/usr/local/bin/*|/usr/local/sbin/*|/nix/store/*)
      exit 1
      ;;
  esac
fi

exit 0
