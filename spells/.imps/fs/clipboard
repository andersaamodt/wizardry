#!/bin/sh
# clipboard MODE [TEXT] - copy to or paste from system clipboard
# Examples: echo "text" | clipboard copy | clipboard paste | clipboard copy "direct text"
# MODE: copy (write stdin/arg to clipboard), paste (read clipboard to stdout)

mode=${1:-}
if [ $# -gt 0 ]; then shift; fi

case $mode in
copy)
  # Detect available clipboard tool
  if command -v pbcopy >/dev/null 2>&1; then
    if [ $# -gt 0 ]; then printf '%s' "$*" | pbcopy
    else pbcopy; fi
  elif command -v xsel >/dev/null 2>&1; then
    if [ $# -gt 0 ]; then printf '%s' "$*" | xsel --clipboard --input
    else xsel --clipboard --input; fi
  elif command -v xclip >/dev/null 2>&1; then
    if [ $# -gt 0 ]; then printf '%s' "$*" | xclip -selection clipboard
    else xclip -selection clipboard; fi
  elif command -v wl-copy >/dev/null 2>&1; then
    if [ $# -gt 0 ]; then printf '%s' "$*" | wl-copy
    else wl-copy; fi
  else
    printf '%s\n' "clipboard: no clipboard utility found (need pbcopy, xsel, xclip, or wl-copy)" >&2
    exit 1
  fi
  ;;
paste)
  if command -v pbpaste >/dev/null 2>&1; then
    pbpaste
  elif command -v xsel >/dev/null 2>&1; then
    xsel --clipboard --output
  elif command -v xclip >/dev/null 2>&1; then
    xclip -selection clipboard -o
  elif command -v wl-paste >/dev/null 2>&1; then
    wl-paste
  else
    printf '%s\n' "clipboard: no clipboard utility found (need pbpaste, xsel, xclip, or wl-paste)" >&2
    exit 1
  fi
  ;;
*)
  printf '%s\n' "clipboard: mode must be 'copy' or 'paste'" >&2
  exit 1
  ;;
esac
