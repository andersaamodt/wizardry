#!/bin/sh
# sed-inplace PATTERN FILE - perform in-place sed substitution portably (mac/linux)
# Example: sed-inplace 's/foo/bar/g' config.txt
set -eu


si_pattern=${1:-}
si_file=${2:-}

if [ -z "$si_pattern" ] || [ -z "$si_file" ]; then
  printf '%s\n' "sed-inplace: requires PATTERN and FILE arguments" >&2
  exit 1
fi

if [ ! -f "$si_file" ]; then
  printf '%s\n' "sed-inplace: not a file: $si_file" >&2
  exit 1
fi

si_tmpfile="${si_file}.sed.$$"
if sed "$si_pattern" "$si_file" > "$si_tmpfile" 2>/dev/null; then
  mv "$si_tmpfile" "$si_file"
else
  rm -f "$si_tmpfile"
  exit 1
fi
