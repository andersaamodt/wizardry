#!/bin/sh
# xattr-helper-usable HELPER - check if an xattr helper command is available and usable
# Returns 0 if helper is available, 1 otherwise
# Respects WIZARDRY_TEST_HELPERS_ONLY to skip system helpers during tests
set -eu


helper=$1

if ! command -v "$helper" >/dev/null 2>&1; then
  exit 1
fi

helper_path=$(command -v "$helper")

if [ "${WIZARDRY_TEST_HELPERS_ONLY-0}" -eq 1 ]; then
  case "$helper_path" in
    /bin/*|/sbin/*|/usr/bin/*|/usr/sbin/*|/usr/local/bin/*|/usr/local/sbin/*|/nix/store/*)
      return 1 ;;
  esac
fi

exit 0
