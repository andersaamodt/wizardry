#!/bin/sh
# to CMD CMD_ARGS TARGET MORE... - append TARGET to command args (alias for into)
# Receives: $1=command, $2=command_args, $3=target, $4+=remaining
# Example: parse cp file.txt to /tmp/dest.txt

_to() {
  _to_cmd=${1:-}
  _to_cmd_args=${2:-}
  shift 2 2>/dev/null || shift $#

  if [ $# -lt 1 ]; then
    printf '%s: to requires a target\n' "to" >&2
    return 1
  fi

  _to_target=$1
  shift

  if [ -z "$_to_cmd" ]; then
    printf '%s: to requires a command before it\n' "to" >&2
    return 1
  fi

  if [ -n "$_to_cmd_args" ]; then
    _to_new_args="$_to_cmd_args $_to_target"
  else
    _to_new_args=$_to_target
  fi

  if [ $# -eq 0 ]; then
    # shellcheck disable=SC2086
    "$_to_cmd" $_to_new_args
    return $?
  fi

  _to_lex_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
  # shellcheck disable=SC2086
  "$_to_lex_dir/parse" "$_to_cmd" $_to_new_args "$@"
}
