#!/bin/sh
# then CMD CMD_ARGS MORE... - execute prior command, then continue if it succeeded
# Receives: $1=command, $2=command_args, $3+=remaining args
# Example: parse echo hello then echo world

_then() {
  _then_cmd=${1:-}
  _then_cmd_args=${2:-}
  shift 2 2>/dev/null || shift $#

  if [ -n "$_then_cmd" ]; then
    # shellcheck disable=SC2086
    if "$_then_cmd" $_then_cmd_args; then
      : # success
    else
      return $?
    fi
  fi

  if [ $# -eq 0 ]; then
    return 0
  fi

  _then_lex_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
  "$_then_lex_dir/parse" "$@"
}
