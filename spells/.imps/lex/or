#!/bin/sh
# or CMD CMD_ARGS MORE... - execute prior command, continue if it failed (||)
# Receives: $1=command, $2=command_args (space-separated), $3+=remaining args
# Example: parse false or echo fallback â†’ outputs "fallback"

set -eu

cmd=${1:-}
cmd_args=${2:-}
shift 2 2>/dev/null || shift $#

# Run the prior command if present
if [ -n "$cmd" ]; then
  # shellcheck disable=SC2086
  if "$cmd" $cmd_args; then
    # Prior command succeeded - don't continue
    exit 0
  fi
fi

# Prior command failed (or no prior) - continue parsing
if [ $# -eq 0 ]; then
  exit 1
fi

exec parse "$@"
