#!/bin/sh
# select-input - detect best input source (stdin/tty/none)
# Example: src=$(select-input) && case $src in stdin) read line ;; tty) read </dev/tty ;; esac
# Set SELECT_INPUT_MODE=stdin|tty|none to override auto-detection

_select_input() {
  case ${SELECT_INPUT_MODE:-auto} in
    stdin) printf '%s\n' stdin; return 0 ;;
    tty)   printf '%s\n' tty;   return 0 ;;
    none)  return 1 ;;
  esac

  # Determine best input source. On macOS, /dev/stdin is a symlink and -p/-s tests
  # are unreliable. Always try stdin first - if it's closed, read will fail gracefully.
  # Only use explicit SELECT_INPUT_MODE to override this behavior.
  if [ -t 0 ]; then
    # stdin is a terminal - use it
    printf '%s\n' stdin
    return 0
  fi

  # stdin is not a terminal - could be piped, redirected, or closed.
  # Return stdin optimistically; if closed, the read will fail immediately.
  printf '%s\n' stdin
  return 0
}

# Self-execute when run directly (not sourced)
case "$0" in
  */select-input) _select_input "$@" ;; esac
