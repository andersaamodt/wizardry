#!/bin/sh
# select-input - detect best input source (stdin/tty/none)
# Example: src=$(select-input) && case $src in stdin) read line ;; tty) read </dev/tty ;; esac
# Set SELECT_INPUT_MODE=stdin|tty|none to override auto-detection

_select_input() {
  case ${SELECT_INPUT_MODE:-auto} in
    stdin) printf '%s\n' stdin; return 0 ;;
    tty)   printf '%s\n' tty;   return 0 ;;
    none)  return 1 ;;
  esac

  # Determine the best input source for reading user input.
  # On macOS, /dev/stdin is a symlink and tests like -p and -s are unreliable.
  # Use -t 0 to check if stdin is a terminal (works reliably cross-platform).
  if [ -t 0 ]; then
    printf '%s\n' stdin
    return 0
  fi

  # stdin is not a terminal - try /dev/tty as fallback
  if [ -r /dev/tty ]; then
    printf '%s\n' tty
    return 0
  fi

  return 1
}

# Self-execute when run directly (not sourced)
case "$0" in
  */select-input) _select_input "$@" ;; esac
