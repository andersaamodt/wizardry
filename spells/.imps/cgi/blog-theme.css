#!/bin/sh
# blog-theme.css - Serve current blog theme CSS

set -eu

http-status 200 "OK"
http-header "Content-Type" "text/css; charset=utf-8"
http-end-headers

# Get site config
site_root=$(get-site-data-dir "..")
site_config="$site_root/site.conf"

# Site directory for theme assets
site_id="${WIZARDRY_SITE_NAME:-default}"
SITES_DIR="${WIZARDRY_SITES_DIR:-$HOME/sites}"
site_dir="$SITES_DIR/$site_id"

theme=$(config-get "$site_config" theme 2>/dev/null || echo "")
if [ -z "$theme" ]; then
  theme="archmage"
fi

case "$theme" in
  archmage|wizard|warlock|sorcerer|sorceress|technomancer|thaumaturge|thelemite\
  |theurgist|wadjet|enchanter|illusionist|lich|druid|empath|shaman|geomancer\
  |hermeticist|hierophant|necromancer|conjurer|pyromancer|chronomancer\
  |alchemist|seer|adept)
    ;;
  *)
    theme="archmage"
    ;;
esac

theme_file="$site_dir/build/static/themes/${theme}.css"
if [ ! -f "$theme_file" ]; then
  theme_file="$site_dir/site/static/themes/${theme}.css"
fi

if [ -f "$theme_file" ]; then
  cat "$theme_file"
else
  printf '/* theme not found: %s */\n' "$theme"
fi
