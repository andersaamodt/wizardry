#!/bin/sh
# chat-delete-room - Delete a chat room if empty or user is last member
set -eu

http-ok-html

# Parse room name from query string
room_name=$(get-query-param "room")

# Trim whitespace
room_name=$(printf '%s' "$room_name" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

if [ -z "$room_name" ]; then
  cat <<HTML
<div class="demo-result error">
  <p>Room name required</p>
</div>
HTML
  exit 0
fi

# Chat rooms directory - use site-specific location
CHAT_DIR=$(get-site-data-dir "chatrooms")
ROOM_DIR="$CHAT_DIR/$room_name"

if [ ! -d "$ROOM_DIR" ]; then
  cat <<HTML
<div class="demo-result error">
  <p>Room not found</p>
</div>
HTML
  exit 0
fi

# For demo purposes, allow deletion
# In production, you'd check if user is the last member
rm -rf "$ROOM_DIR"

cat <<HTML
<div class="demo-result success">
  <p>âœ“ Room <strong>$room_name</strong> deleted</p>
</div>
HTML
