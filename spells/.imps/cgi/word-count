#!/bin/sh
# word-count - Count words in submitted text
set -eu

http-status 200 "OK"
http-header "Content-Type" "text/html"
http-end-headers

# Parse query string to get text parameter
text=""
if [ -n "${QUERY_STRING:-}" ]; then
  # Extract text=value from query string (before url-decode)
  encoded=$(printf '%s' "$QUERY_STRING" | sed 's/^text=//' | sed 's/&.*//')
  # Decode the URL-encoded value
  text=$(url-decode "$encoded")
fi

if [ -z "$text" ]; then
  cat <<HTML
<div class="demo-result">
  <p>No text provided</p>
</div>
HTML
else
  # Use echo to ensure proper line counting
  words=$(printf '%s\n' "$text" | wc -w | tr -d ' ')
  chars=$(printf '%s\n' "$text" | wc -c | tr -d ' ')
  # For lines, count newlines in the text plus one
  lines=$(printf '%s\n' "$text" | wc -l | tr -d ' ')
  lines=$((lines + 1))
  
  cat <<HTML
<div class="demo-result">
  <table>
    <tr><th>Words</th><td>$words</td></tr>
    <tr><th>Characters</th><td>$chars</td></tr>
    <tr><th>Lines</th><td>$lines</td></tr>
  </table>
</div>
HTML
fi
