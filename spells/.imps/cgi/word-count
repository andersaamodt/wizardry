#!/bin/sh
# word-count - Count words in submitted text
set -eu

http-ok-html

# Parse query string to get text parameter
text=$(get-query-param "text")

if [ -z "$text" ]; then
  cat <<HTML
<div class="demo-result">
  <p>No text provided</p>
</div>
HTML
else
  # Count words and characters using newline version for wc compatibility
  words=$(printf '%s\n' "$text" | wc -w | tr -d ' ')
  chars=$(printf '%s' "$text" | wc -c | tr -d ' ')
  
  # Count actual newlines in the text
  # wc -l counts newline characters, so text without newlines = 0
  # We want 1 line if no newlines, 2 lines if 1 newline, etc.
  newline_count=$(printf '%s' "$text" | wc -l | tr -d ' ')
  lines=$((newline_count + 1))
  
  cat <<HTML
<div class="demo-result">
  <table>
    <tr><th>Words</th><td>$words</td></tr>
    <tr><th>Characters</th><td>$chars</td></tr>
    <tr><th>Lines</th><td>$lines</td></tr>
  </table>
</div>
HTML
fi
