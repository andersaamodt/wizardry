#!/bin/sh
# blog-get-config - Get blog configuration settings

set -eu

http-status 200 "OK"
http-header "Content-Type" "application/json"
http-end-headers

# Get site config
site_root=$(get-site-data-dir "..")
site_config="$site_root/site.conf"

# Default values
registration_enabled=$(config-get "$site_config" registration_enabled 2>/dev/null || echo "")
site_title=$(config-get "$site_config" site_title 2>/dev/null || echo "")
theme=$(config-get "$site_config" theme 2>/dev/null || echo "")

if [ -z "$registration_enabled" ]; then
  registration_enabled="true"
fi

if [ -z "$site_title" ]; then
  site_title="My Blog"
fi

if [ -z "$theme" ]; then
  theme="archmage"
fi

# Return config
printf '{"success":true,"registration_enabled":%s,"site_title":"%s","theme":"%s"}\n' \
  "$registration_enabled" "$site_title" "$theme"
