#!/bin/sh
# cgi-env - Output CGI environment variables for debugging
# Useful for troubleshooting CGI issues and understanding request context
set -eu

http-ok-html

cat <<'HTML'
<div class="debug-info" style="font-family: monospace; background: #f5f5f5; padding: 15px; border-radius: 5px;">
  <h3>CGI Environment</h3>
  <table style="width: 100%; border-collapse: collapse;">
    <tr style="border-bottom: 1px solid #ddd;">
      <th style="text-align: left; padding: 8px;">Variable</th>
      <th style="text-align: left; padding: 8px;">Value</th>
    </tr>
HTML

# Common CGI variables
for var in REQUEST_METHOD REQUEST_URI QUERY_STRING CONTENT_TYPE CONTENT_LENGTH \
           SERVER_NAME SERVER_PORT REMOTE_ADDR REMOTE_HOST HTTP_USER_AGENT \
           HTTP_REFERER HTTP_ACCEPT SCRIPT_NAME PATH_INFO GATEWAY_INTERFACE \
           SERVER_PROTOCOL SERVER_SOFTWARE; do
  eval "value=\${$var:-}"
  if [ -n "$value" ]; then
    # HTML escape the value
    value=$(printf '%s' "$value" | sed 's/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g; s/"/\&quot;/g')
    printf '    <tr><td style="padding: 8px;"><strong>%s</strong></td><td style="padding: 8px;">%s</td></tr>\n' "$var" "$value"
  fi
done

cat <<'HTML'
  </table>
</div>
HTML
