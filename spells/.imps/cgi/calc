#!/bin/sh
# calc - Simple calculator CGI script
set -eu

http-ok-html

# Parse query string to get expr parameter
expr=$(get-query-param "expr")

if [ -z "$expr" ]; then
  cat <<HTML
<div class="demo-result error">
  <p>No expression provided</p>
</div>
HTML
else
  # Safely evaluate (only allow numbers and basic operators plus whitespace)
  if printf '%s' "$expr" | grep -qE '^[0-9+\-\*/ ().[:space:]]+$'; then
    result=$(printf '%s\n' "$expr" | bc 2>/dev/null || echo "Error")
    cat <<HTML
<div class="demo-result">
  <p><code>$expr</code> = <strong>$result</strong></p>
</div>
HTML
  else
    cat <<HTML
<div class="demo-result error">
  <p>Invalid expression (only numbers and +, -, *, / allowed)</p>
</div>
HTML
  fi
fi
