#!/bin/sh
# reverse-text - Reverse the input text
set -eu

http-status 200 "OK"
http-header "Content-Type" "text/html"
http-end-headers

# Parse query string to get text parameter
text=""
if [ -n "${QUERY_STRING:-}" ]; then
  # Extract text=value from query string (before url-decode)
  encoded=$(printf '%s' "$QUERY_STRING" | sed 's/^text=//' | sed 's/&.*//')
  # Decode the URL-encoded value
  text=$(url-decode "$encoded")
fi

if [ -z "$text" ]; then
  reversed="(empty)"
else
  reversed=$(printf '%s' "$text" | rev)
fi

cat <<HTML
<div class="demo-result">
  <p>Original: <code>$text</code></p>
  <p>Reversed: <strong>$reversed</strong></p>
</div>
HTML
