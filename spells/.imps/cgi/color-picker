#!/bin/sh
# color-picker - Return color information
set -eu

http-status 200 "OK"
http-header "Content-Type" "text/html"
http-end-headers

color="${QUERY_STRING:-#3498db}"
color=$(printf '%s' "$color" | sed 's/color=//' | url-decode)

# Extract RGB components and calculate brightness
# Remove # prefix
hex=$(printf '%s' "$color" | sed 's/^#//')

# Convert hex to decimal RGB using POSIX-compliant substring extraction
r=$(printf '%s' "$hex" | cut -c1-2)
g=$(printf '%s' "$hex" | cut -c3-4)
b=$(printf '%s' "$hex" | cut -c5-6)
r=$((16#$r))
g=$((16#$g))
b=$((16#$b))

# Calculate perceived brightness (0-255)
# Using formula: (R * 299 + G * 587 + B * 114) / 1000
brightness=$(( (r * 299 + g * 587 + b * 114) / 1000 ))

# Use white text for dark colors, black text for light colors
if [ "$brightness" -lt 128 ]; then
  text_color="white"
  shadow="1px 1px 2px black"
else
  text_color="black"
  shadow="1px 1px 2px white"
fi

cat <<HTML
<div class="demo-result" style="background: ${color}; padding: 20px; border-radius: 8px; margin: -1rem; margin-bottom: 0;">
  <p style="color: ${text_color}; text-shadow: ${shadow}; margin: 0;"><strong>Selected: ${color}</strong></p>
</div>
HTML
