#!/bin/sh
# declare-globals - centralized declaration of all allowed global environment variables.
#
# When sourced in a script that uses `set -u`, this imp prevents undeclared global
# environment variables from being used. Every global must be declared here with a
# justification comment explaining why it is required.
#
# Usage: . declare-globals
#        (Source this file at the start of scripts that need strict global checking.)
#
# After sourcing, scripts with `set -u` will fail if they reference undeclared globals.
# Add new globals here with a justification comment when absolutely necessary.
# PREFER passing --flag arguments over globals for configuration.

# =============================================================================
# DECLARED GLOBALS (each must have a justification comment above it)
# =============================================================================

# --- Core Installation ---

# Directory where wizardry is installed. Required for scripts to locate
# resources relative to the installation root.
: "${WIZARDRY_DIR:=}"

# --- User Data ---

# Directory for user's spellbook. Contains user-created spells and the
# .memorized file for the cast menu. Required for spell storage coordination.
: "${SPELLBOOK_DIR:=}"

# MUD configuration directory. Required for MUD features to know where
# to store room descriptions and other MUD-related configuration.
: "${MUD_DIR:=}"

# --- Shell Configuration (learn-spell chain) ---

# Shell RC file path. Required for learn-spell to pass detected shell config
# to spell install() functions without redundant re-detection.
: "${WIZARDRY_RC_FILE:=}"

# Format of the shell RC file (bash/zsh/fish/sh). Required for spell install()
# functions to generate correct shell-specific syntax.
: "${WIZARDRY_RC_FORMAT:=}"

# Shell platform identifier. Required for learn-spell to coordinate platform
# detection across nested spell installations.
: "${WIZARDRY_PLATFORM:=}"

# Target path during spell memorization. Required for learn-spell to
# communicate the spell's installation path to install() functions.
: "${WIZARDRY_MEMORIZE_TARGET:=}"

# --- Automation Flags ---
# These are needed for non-interactive scripted installations (CI/CD)

# Skip confirmation prompts in system-modifying scripts.
: "${WIZARDRY_SKIP_CONFIRM:=}"

# Skip NixOS rebuild during updates (for testing).
: "${WIZARDRY_SKIP_NIX_REBUILD:=}"

# Assume yes to update-all prompts (automated updates).
: "${WIZARDRY_UPDATE_ALL_ASSUME_YES:=}"

# Distribution override for update-all (testing).
: "${WIZARDRY_UPDATE_ALL_DISTRO:=}"

# --- Test Infrastructure ---
# (WIZARDRY_ prefix for namespacing in test environments)

# Flag to load only test helpers, not full spell functionality.
: "${WIZARDRY_TEST_HELPERS_ONLY:=}"

# Temporary directory for wizardry test operations.
: "${WIZARDRY_TMPDIR:=}"

# System PATH saved before test PATH modifications.
: "${WIZARDRY_SYSTEM_PATH:=}"

# Flag to disable sandbox in tests.
: "${WIZARDRY_DISABLE_SANDBOX:=}"

# Flag to enable macOS sandbox (disabled by default).
: "${WIZARDRY_ENABLE_MACOS_SANDBOX:=}"

# Flag indicating sandbox warning already shown.
: "${WIZARDRY_BWRAP_WARNING:=}"

# Path to sandbox warning flag file.
: "${WIZARDRY_BWRAP_WARN_FILE:=}"
