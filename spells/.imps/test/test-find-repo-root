#!/bin/sh
# find-repo-root - find the wizardry repository root directory
# Testing imp - walks up from current directory to find spells/ and .tests/
# Example: ROOT=$(find-repo-root)

_test_find_repo_root() {
  _tfr_dir=$(CDPATH= cd -- "$(dirname "${0:-$PWD}")" && pwd -P)
  while [ "$_tfr_dir" != "/" ]; do
    if [ -d "$_tfr_dir/spells" ] && [ -d "$_tfr_dir/.tests" ]; then
      printf '%s\n' "$_tfr_dir"
      return 0
    fi
    _tfr_dir=$(dirname "$_tfr_dir")
  done
  printf '%s\n' "$(pwd -P)"
}

# Self-execute when run directly (not sourced)
case "$0" in
  */test-find-repo-root) _test_find_repo_root "$@" ;; esac
