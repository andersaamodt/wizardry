#!/bin/sh
# write-sudo-stub FIXTURE - create a sudo stub script in fixture/bin
# Stub strips common flags and executes the actual command.
set -eu

_write_sudo_stub() {
  fixture=$1
  cat <<'STUB' >"$fixture/bin/sudo"
#!/bin/sh
# Strip common sudo flags before executing the actual command.
# This stub handles flags used by wizardry spells; add more as needed.
set -eu
while [ $# -gt 0 ]; do
  case "$1" in
    -n|--non-interactive) shift ;;  # Skip non-interactive flag
    --)                   shift; break ;;  # End of options
    *)                    break ;;  # First non-flag argument
  esac
done
exec "$@"
STUB
  chmod +x "$fixture/bin/sudo"
}

# Self-execution when run directly (not sourced)
set -eu
case "${0##*/}" in write-sudo-stub) _write_sudo_stub "$@" ;; esac
