#!/bin/sh
# stub-forget-command COMMAND DIR - hide a command from PATH by overriding has function
set -eu

command_name=$1
dir=$2

# Create a file that overrides the has function to hide this command
# Tests should source this file after invoke-wizardry
cat >"$dir/forget-${command_name}" <<OVERRIDE
# Override has function to hide $command_name
_original_has_impl() {
  command -v "\$1" >/dev/null 2>&1
}

has() {
  if [ "\$1" = "$command_name" ]; then
    return 1  # Command not found
  fi
  _original_has_impl "\$@"
}
OVERRIDE

# Also create the actual command stub that fails
# This ensures even direct calls to the command fail
cat >"$dir/$command_name" <<'STUB'
#!/bin/sh
exit 127
STUB
chmod +x "$dir/$command_name"
