#!/bin/sh
# write-nix-env-stub FIXTURE - create a nix-env stub script in fixture/bin
# Stub logs invocations to NIX_ENV_LOG and exits with NIX_ENV_EXIT code.
set -eu

_write_nix_env_stub() {
  fixture=$1
  cat <<'STUB' >"$fixture/bin/nix-env"
#!/bin/sh
echo "$0 $*" >>"${NIX_ENV_LOG:?}" || exit 1
exit ${NIX_ENV_EXIT:-0}
STUB
  chmod +x "$fixture/bin/nix-env"
}

# Self-execution when run directly (not sourced)
set -eu
case "${0##*/}" in write-nix-env-stub) _write_nix_env_stub "$@" ;; esac
