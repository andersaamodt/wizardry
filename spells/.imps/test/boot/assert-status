#!/bin/sh
# assert-status EXPECTED [ACTUAL] - verify status matches expected exit code
# If ACTUAL not provided, reads from $STATUS variable for backward compatibility.
# Sets TEST_FAILURE_REASON on mismatch.
set -eu

expected_status=$1
actual_status=${2:-${STATUS-999}}
if [ "$actual_status" -ne "$expected_status" ]; then
  if [ -n "${ERROR-}" ]; then
    TEST_FAILURE_REASON="expected status $expected_status but got $actual_status; stderr: $ERROR"
  else
    TEST_FAILURE_REASON="expected status $expected_status but got $actual_status"
  fi
  export TEST_FAILURE_REASON
  # Write to file so parent process can read it
  printf '%s' "$TEST_FAILURE_REASON" > "${WIZARDRY_TMPDIR}/_test_failure_reason" 2>/dev/null || true
  exit 1
fi
exit 0


