#!/bin/sh
# assert-status EXPECTED - verify STATUS matches expected exit code
# Sets TEST_FAILURE_REASON on mismatch.

set -eu
. env-clear

_assert_status() {
  expected_status=$1
  if [ "$STATUS" -ne "$expected_status" ]; then
    if [ -n "${ERROR-}" ]; then
      TEST_FAILURE_REASON="expected status $expected_status but got $STATUS; stderr: $ERROR"
    else
      TEST_FAILURE_REASON="expected status $expected_status but got $STATUS"
    fi
    return 1
  fi
  return 0
}

# Self-execution when run directly (not sourced)
case "${0##*/}" in assert-status) _assert_status "$@" ;; esac
