#!/bin/sh
# run-test-case DESC FUNC - execute a named test function and report its result
# Runs the function, captures TEST_FAILURE_REASON, and calls report-result.

_run_test_case() {
  desc=$1
  func=$2
  _test_index=$((_test_index + 1))
  if "$func"; then
    _report_result "$desc" 0
  else
    reason=${TEST_FAILURE_REASON-}
    _report_result "$desc" 1 "$reason"
    _record_failure_detail "$_test_index"
    unset TEST_FAILURE_REASON || true
  fi
}

# Self-execution when run directly (not sourced)
case "${0##*/}" in run-test-case) _run_test_case "$@" ;; esac
