#!/bin/sh
# test-skip DESC REASON - output a test skip message
# Example: test-skip "spell handles error" "mode mismatch"

set -eu

test_skip() {
  desc=$1
  reason=${2-}
  
  # Get global subtest number if available
  num=${WIZARDRY_GLOBAL_SUBTEST_NUM-}
  
  # Format the test number [x/y] if total is known
  num_str=""
  if [ -n "$num" ]; then
    if [ -n "${WIZARDRY_GLOBAL_SUBTEST_TOTAL-}" ] && [ "$WIZARDRY_GLOBAL_SUBTEST_TOTAL" -gt 0 ]; then
      num_str="[${num}/${WIZARDRY_GLOBAL_SUBTEST_TOTAL}] "
    else
      num_str="#${num} "
    fi
  fi
  
  if [ -n "$num" ]; then
    # When run through test-magic with global numbering
    if [ -n "$reason" ]; then
      printf 'SKIP %s%s: %s\n' "$num_str" "$desc" "$reason"
    else
      printf 'SKIP %s%s\n' "$num_str" "$desc"
    fi
  else
    # When run standalone, use old format for backward compatibility
    if [ -n "$reason" ]; then
      printf '  SKIP %s %s\n' "$desc" "$reason"
    else
      printf '  SKIP %s\n' "$desc"
    fi
  fi
}

# Self-execution when run directly (not sourced)
case "${0##*/}" in test-skip) test_skip "$@" ;; esac
