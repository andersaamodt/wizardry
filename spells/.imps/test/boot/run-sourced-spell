#!/bin/sh
# run-sourced-spell SCRIPT [ARGS...] - DEPRECATED source-and-invoke spell runner
# Historical note: This was used to test spells by sourcing them and invoking
# their functions when the castable/uncastable pattern was in use.
# Since spells are now flat linear scripts, this pattern is no longer applicable.
# This imp is retained for backward compatibility but uses direct execution.
set -eu

# Find repository root for absolute paths
script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
repo_root=$(cd "$script_dir" && while [ ! -d "spells" ] && [ "$(pwd)" != "/" ]; do cd ..; done; pwd)

# Since sourced-spell pattern is deprecated, just use direct execution via run-cmd
# This matches the behavior in run-spell when WIZARDRY_USE_SOURCED_SPELL=0
script=$1
shift || true
"$repo_root/spells/.imps/test/boot/run-cmd" "$ROOT_DIR/$script" "$@"
