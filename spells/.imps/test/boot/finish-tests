#!/bin/sh
# finish-tests - print test summary and return appropriate exit status
# Returns 0 if all tests passed, 1 otherwise. Prints failure indices if any.

_finish_tests() {
  total=$((_pass_count + _fail_count))
  printf '%s/%s tests passed' "$_pass_count" "$total"
  if [ "$_fail_count" -gt 0 ]; then
    printf ' (%s failed' "$_fail_count"
    if [ "${_skip_count-0}" -gt 0 ]; then
      printf ', %s skipped' "$_skip_count"
    fi
    printf ')\n'
    if [ -n "$_fail_detail_indices" ]; then
      printf 'FAIL_DETAIL:%s\n' "$_fail_detail_indices"
    fi
    return 1
  fi
  if [ "${_skip_count-0}" -gt 0 ]; then
    printf ' (%s skipped)\n' "$_skip_count"
  else
    printf '\n'
  fi
  return 0
}

# Self-execution when run directly (not sourced)
case "${0##*/}" in finish-tests) _finish_tests "$@" ;; esac
