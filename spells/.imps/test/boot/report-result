#!/bin/sh
# report-result NUM DESC STATUS - record the result of a test case
# Prints PASS or FAIL with description, incrementing global counters.
# Uses counter files in WIZARDRY_TMPDIR for cross-imp state sharing.
# NUM is the subtest number (passed as argument, no globals)
# REASON can be set via TEST_FAILURE_REASON environment variable
set -eu

num=$1
desc=$2
status=$3
reason=${TEST_FAILURE_REASON-}

# Read current counter values from files
_pass_count=$(cat "${WIZARDRY_TMPDIR}/_pass_count")
_fail_count=$(cat "${WIZARDRY_TMPDIR}/_fail_count")

if [ "$status" -eq 0 ]; then
  _pass_count=$((_pass_count + 1))
  printf '%s' "$_pass_count" > "${WIZARDRY_TMPDIR}/_pass_count"
  test-pass "$num" "$desc"
else
  _fail_count=$((_fail_count + 1))
  printf '%s' "$_fail_count" > "${WIZARDRY_TMPDIR}/_fail_count"
  test-fail "$num" "$desc" "$reason"
fi


