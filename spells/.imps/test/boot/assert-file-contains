#!/bin/sh
# assert-file-contains FILE SUBSTRING - verify file contains the substring
# Sets TEST_FAILURE_REASON on mismatch or missing file.
set -eu

file=$1
substring=$2
if [ ! -f "$file" ]; then
  TEST_FAILURE_REASON="expected file missing: $file"
  export TEST_FAILURE_REASON
  printf '%s' "$TEST_FAILURE_REASON" > "${WIZARDRY_TMPDIR}/_test_failure_reason" 2>/dev/null || true
  exit 1
fi

if grep -F -- "$substring" "$file" >/dev/null 2>&1; then
  exit 0
fi

TEST_FAILURE_REASON="file $file missing substring: $substring"
export TEST_FAILURE_REASON
printf '%s' "$TEST_FAILURE_REASON" > "${WIZARDRY_TMPDIR}/_test_failure_reason" 2>/dev/null || true
exit 1


