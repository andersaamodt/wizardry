#!/bin/sh
# run-bwrap - execute bubblewrap with optional sudo support
# Wraps bwrap invocation, using sudo when BWRAP_VIA_SUDO is set.

set -eu
. env-clear

_run_bwrap() {
  if [ "${BWRAP_VIA_SUDO:-0}" -eq 1 ]; then
    # Use REAL_SUDO_BIN to avoid picking up a test stub sudo from PATH
    "${REAL_SUDO_BIN:?}" -n "${BWRAP_BIN:?}" "$@"
  else
    "${BWRAP_BIN:?}" "$@"
  fi
}

# Self-execution when run directly (not sourced)
case "${0##*/}" in run-bwrap) _run_bwrap "$@" ;; esac
