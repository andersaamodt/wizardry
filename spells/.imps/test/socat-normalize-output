#!/bin/sh
# socat-normalize-output - strip ANSI escapes and carriage returns
# Reads from stdin, writes normalized output to stdout
#
# This normalizes PTY output for assertions by removing:
# - ANSI escape sequences (colors, cursor movement, etc.)
# - Carriage returns (\r)
# - Other control characters

set -eu

# Remove ANSI escape sequences
# Pattern: ESC followed by [ and then any number of characters until a letter
# This catches most ANSI sequences including colors, cursor movements, etc.
sed \
  -e 's/\x1b\[[0-9;]*[a-zA-Z]//g' \
  -e 's/\x1b\[[0-9;]*m//g' \
  -e 's/\x1b\[?[0-9;]*[hlJKmsu]//g' \
  -e 's/\r//g' \
  -e 's/\x1b[()][AB012]//g'
