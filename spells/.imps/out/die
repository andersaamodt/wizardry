#!/bin/sh
# die [CODE] MESSAGE - print to stderr and exit (default code 1)
# Examples: die "fatal error" | die 2 "file not found"
set -eu

_die() {
  case "$1" in
    [0-9]|[0-9][0-9]|[0-9][0-9][0-9]) _die_code=$1; shift ;;
    *) _die_code=1 ;;
  esac
  printf '%s\n' "$*" >&2
  return "$_die_code"
}

# Self-execute when run directly (not sourced)
set -eu
case "$0" in
  */die) _die "$@" ;; esac
