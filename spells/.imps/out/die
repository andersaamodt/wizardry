#!/bin/sh
# die [CODE] MESSAGE - print to stderr and exit script (default code 1)
#
# Uses 'return' not 'exit' for word-of-binding compatibility.
# When called from a spell function, the function returns with error code,
# which causes the script to exit. This allows spells to be both sourced
# (for word-of-binding) and executed (as standalone scripts).
#
# Examples: die "fatal error" | die 2 "file not found"
set -eu

_die() {
  case "$1" in
    [0-9]|[0-9][0-9]|[0-9][0-9][0-9]) _die_code=$1; shift ;;
    *) _die_code=1 ;;
  esac
  printf '%s\n' "$*" >&2
  return "$_die_code"
}

# Self-execute when run directly (not sourced)
case "$0" in
  */die) _die "$@" ;; esac
