#!/bin/sh
# app-verb VERBS_FILE VERB [ARGS...] - execute predefined command verb with validated args

set -eu

verbs_file=${1-}
verb=${2-}
shift 2 || true

if [ -z "$verbs_file" ] || [ -z "$verb" ]; then
  printf '%s\n' "app-verb: requires verbs file and verb name" >&2
  exit 1
fi

if [ ! -f "$verbs_file" ]; then
  printf '%s\n' "app-verb: verbs file not found: $verbs_file" >&2
  exit 1
fi

# Parse verbs.conf to find matching verb definition
# Format: VERB_NAME command arg1 arg2 ...
verb_line=$(grep "^$verb " "$verbs_file" 2>/dev/null || true)

if [ -z "$verb_line" ]; then
  printf '%s\n' "app-verb: verb not found: $verb" >&2
  exit 1
fi

# Extract command and fixed args from verb definition
# Remove verb name, leaving command and template
verb_cmd=$(printf '%s' "$verb_line" | cut -d' ' -f2-)

# Build complete command by replacing placeholders with validated args
# For now, simple implementation: append args to command
# shellcheck disable=SC2086
exec $verb_cmd "$@"
