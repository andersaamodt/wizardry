#!/bin/sh
# abs-path PATH - resolve path to absolute (directories cd'd, files via parent)
# Example: abs=$(abs-path ./foo) -> /current/dir/foo
# Note: Returns original path unchanged if directory cannot be resolved.
set -eu


ap_loc=$1
if [ -d "$ap_loc" ]; then
  CDPATH= cd -- "$ap_loc" 2>/dev/null && pwd -P | sed 's|///*|/|g'
  exit
fi
ap_dir=${_ap_loc%/*}
ap_base=${_ap_loc##*/}
if [ "$ap_dir" = "$ap_loc" ]; then
  _ap_dir=.
fi
if CDPATH= cd -- "$ap_dir" 2>/dev/null; then
  printf '%s/%s\n' "$(pwd -P)" "$ap_base" | sed 's|///*|/|g'
  exit
fi
printf '%s\n' "$ap_loc"
