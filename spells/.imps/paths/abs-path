#!/bin/sh
# abs-path PATH - resolve path to absolute (directories cd'd, files via parent)
# Example: abs=$(abs-path ./foo) -> /current/dir/foo
# Note: Returns original path unchanged if directory cannot be resolved.

_abs_path() {
  _ap_loc=$1
  if [ -d "$_ap_loc" ]; then
    CDPATH= cd -- "$_ap_loc" 2>/dev/null && pwd -P | sed 's|///*|/|g'
    return
  fi
  _ap_dir=${_ap_loc%/*}
  _ap_base=${_ap_loc##*/}
  if [ "$_ap_dir" = "$_ap_loc" ]; then
    _ap_dir=.
  fi
  if CDPATH= cd -- "$_ap_dir" 2>/dev/null; then
    printf '%s/%s\n' "$(pwd -P)" "$_ap_base" | sed 's|///*|/|g'
    return
  fi
  printf '%s\n' "$_ap_loc"
}

# Self-execute when run directly (not sourced)
case "$0" in
  */abs-path) _abs_path "$@" ;; esac
