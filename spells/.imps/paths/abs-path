#!/bin/sh
# abs-path PATH - resolve path to absolute (directories cd'd, files via parent)
# Example: abs=$(abs-path ./foo) -> /current/dir/foo
# Note: Returns original path unchanged if directory cannot be resolved.
set -eu


_ap_loc=$1
if [ -d "$_ap_loc" ]; then
  CDPATH= cd -- "$_ap_loc" 2>/dev/null && pwd -P | sed 's|///*|/|g'
  exit
fi
_ap_dir=${_ap_loc%/*}
_ap_base=${_ap_loc##*/}
if [ "$_ap_dir" = "$_ap_loc" ]; then
  _ap_dir=.
fi
if CDPATH= cd -- "$_ap_dir" 2>/dev/null; then
  printf '%s/%s\n' "$(pwd -P)" "$_ap_base" | sed 's|///*|/|g'
  exit
fi
printf '%s\n' "$_ap_loc"
