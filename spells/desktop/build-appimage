#!/bin/sh

# Build an AppImage package for a desktop app (Linux).

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: build-appimage <app-name>

Build an AppImage package for a desktop app on Linux.

This creates a standalone AppImage that bundles the app with
a minimal runtime and the wizardry host binary.

Example:
  build-appimage menu-app

Note: This is a placeholder. Native host binary implementation
and AppImage packaging are planned for future releases.

The spec is complete and ready for implementation:
- Host binary launches login shell and sources invoke-wizardry
- Captures environment (PATH, etc.) for command execution
- Loads WebView with app's index.html
- Provides native bridge for executing hardcoded commands from GUI
- Commands executed via execvp() with no shell parsing

See also: build-macapp, build-apps
USAGE
  exit 0
  ;;
esac

set -eu

app_name=${1-}

if [ -z "$app_name" ]; then
  printf '%s\n' "build-appimage: requires app name" >&2
  printf '%s\n' "Try: build-appimage --help" >&2
  exit 2
fi

# Use WIZARDRY_DIR from environment
wizardry_dir=${WIZARDRY_DIR:-$HOME/.wizardry}
apps_dir="$wizardry_dir/.apps"
app_path="$apps_dir/$app_name"

# Validate app exists
if ! app-validate "$app_path"; then
  printf '%s\n' "build-appimage: invalid app: $app_name" >&2
  exit 1
fi

# Placeholder implementation
printf '%s\n' "build-appimage: AppImage packaging not yet implemented"
printf '%s\n' "App validated: $app_name"
printf '%s\n' ""
printf '%s\n' "Future implementation will:"
printf '%s\n' "  1. Compile host binary with WebView support"
printf '%s\n' "  2. Bundle app files (index.html, style.css)"
printf '%s\n' "  3. Package as AppImage with AppImageTool"
printf '%s\n' "  4. Output: $app_name.AppImage"
printf '%s\n' ""
printf '%s\n' "See .apps/README.md for architecture details."
