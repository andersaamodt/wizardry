#!/bin/sh

# Manage Lightning wallets directly through lightning-cli.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: lightning-wallet-menu

Displays wallet-focused Lightning commands.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu
. env-clear
. colors

trap 'exit 0' INT TERM

first_run=1

while true; do
  if [ "$first_run" -eq 0 ]; then
    printf '\n'
  else
    first_run=0
  fi

  # Build wallet menu
  title="${BOLD}${CYAN}Lightning Wallet"
  exit_label=$(exit-label)
  exit_option="${exit_label}%kill -TERM \$PPID"
  
  new_addr="New Address%lightning-cli newaddr"
  list_funds="List Funds%lightning-cli listfunds"
  withdraw="Withdraw%printf 'Destination: '; read -r dest; printf 'Amount (sats): '; read -r amt; lightning-cli withdraw \"\$dest\" \"\$amt\""
  
  menu "$title" "$new_addr" "$list_funds" "$withdraw" "$exit_option" || true
done
