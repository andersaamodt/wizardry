#!/bin/sh

# Check if Tor daemon is currently running.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: is-tor-running

Checks whether tor is active; exits 0 if running, 1 if not.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu

# Check if tor process is running
# Use pgrep if available for more accurate detection
if command -v pgrep >/dev/null 2>&1; then
    # Check for exact match OR tor with arguments (like tor -f /path/to/torrc)
    if pgrep -x tor >/dev/null 2>&1 || pgrep tor >/dev/null 2>&1; then
        exit 0
    fi
else
    # Fallback to ps + grep, but be more specific
    ps aux | grep -v grep | grep -q 'tor$\|tor ' && exit 0
fi

exit 1
