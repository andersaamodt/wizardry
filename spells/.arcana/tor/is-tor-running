#!/bin/sh

# Check if Tor daemon is currently running.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: is-tor-running

Checks whether tor is active; exits 0 if running, 1 if not.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu

# Check if tor process is running
# On macOS, check launchd first (system-level services need sudo)
if [ "$(uname -s 2>/dev/null)" = "Darwin" ]; then
  # Check if launchd service is loaded (need sudo for system-level services)
  if sudo launchctl list 2>/dev/null | grep -q "org.torproject.tor"; then
    exit 0
  fi
fi

# Use pgrep if available for more accurate detection
if command -v pgrep >/dev/null 2>&1; then
    pgrep -x tor >/dev/null 2>&1 && exit 0
else
    # Fallback to ps + grep, but be more specific
    ps aux | grep -v grep | grep -q 'tor$\|tor ' && exit 0
fi

exit 1
