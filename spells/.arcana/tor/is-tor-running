#!/bin/sh

# Check if Tor daemon is currently running.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: is-tor-running

Checks whether tor is active; exits 0 if running, 1 if not.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu

# Check if tor process is running
# Use pgrep if available for more accurate detection
if command -v pgrep >/dev/null 2>&1; then
    if pgrep -x tor >/dev/null 2>&1; then
        if [ -t 1 ]; then
            echo "Tor is running."
        fi
        exit 0
    fi
else
    # Fallback to ps + grep, but be more specific
    if ps aux | grep -v grep | grep -q 'tor$\|tor '; then
        if [ -t 1 ]; then
            echo "Tor is running."
        fi
        exit 0
    fi
fi

if [ -t 1 ]; then
    echo "Tor is not running."
fi
exit 1
