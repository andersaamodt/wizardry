#!/bin/sh
# Stop tor service

set -eu

# Check if tor is running first
if ! is-tor-running >/dev/null 2>&1; then
  printf 'stop-tor: tor is not running\n' >&2
  exit 1
fi

printf 'Stopping tor...\n'

# Try brew services first on macOS (if tor installed via homebrew)
if command -v brew >/dev/null 2>&1; then
  if brew list tor >/dev/null 2>&1; then
    if brew services stop tor 2>/dev/null; then
      printf 'Tor stopped via brew services.\n'
      exit 0
    fi
  fi
fi

# Try systemctl (Linux with systemd)
if command -v systemctl >/dev/null 2>&1; then
  if sudo systemctl stop tor 2>/dev/null; then
    printf 'Tor stopped via systemctl.\n'
    exit 0
  fi
fi

# Try killall (macOS and others)
if sudo killall tor 2>/dev/null; then
  printf 'Tor stopped.\n'
  exit 0
fi

printf 'stop-tor: could not stop tor\n' >&2
exit 1
