#!/bin/sh

# Present the Node.js management menu.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: node-menu

Displays the Node.js management menu.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu
. env-clear
. colors

trap 'exit 0' INT TERM

first_run=1

while true; do
  if [ "$first_run" -eq 0 ]; then
    printf '\n'
  else
    first_run=0
  fi

  # Build menu based on Node.js installation status
  title="${BOLD}${CYAN}Node.js: $(node-status)"
  exit_label=$(exit-label)
  exit_option="${exit_label}%kill -TERM \$PPID"
  
  if command -v node >/dev/null 2>&1; then
    uninstall_option="Uninstall Node.js%uninstall-node"
    version_option="Show Version%node --version"
    menu "$title" "$version_option" "$uninstall_option" "$exit_option" || true
  else
    install_option="Install Node.js%install-node"
    menu "$title" "$install_option" "$exit_option" || true
  fi
done
