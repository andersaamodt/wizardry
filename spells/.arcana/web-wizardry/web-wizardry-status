#!/bin/sh

# Report installation status for web wizardry components.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: web-wizardry-status

Reports the installation status of web wizardry components (pandoc, nginx, fcgiwrap, openssl, htmx, certbot, coreutils).
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu
. env-clear

if command -v colors >/dev/null 2>&1; then
  # shellcheck source=/dev/null
  . colors
else
  RESET=""
  THEME_SUCCESS=""
  THEME_WARNING=""
  GREY=""
fi

# Count installed components
installed=0
total=7

script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd)

# Check each component using the helper
for component in pandoc nginx fcgiwrap openssl htmx certbot coreutils; do
  if "$script_dir/is-web-component-installed" "$component" 2>/dev/null; then
    installed=$((installed + 1))
  fi
done

if [ "$installed" -eq 0 ]; then
  color="$GREY"
  status="not installed"
elif [ "$installed" -eq "$total" ]; then
  color="$THEME_SUCCESS"
  status="installed"
else
  color="$THEME_WARNING"
  status="$installed/$total installed"
fi

printf "%s%s%s\n" "$color" "$status" "$RESET"
