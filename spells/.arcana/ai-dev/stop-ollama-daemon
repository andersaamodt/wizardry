#!/bin/sh

# Stop the ollama daemon.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: stop-ollama-daemon

Stops the ollama daemon service.
USAGE
  exit 0
  ;;
esac

set -eu
. env-clear

script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd)

run_priv() {
  if [ "$(id -u)" -eq 0 ]; then
    "$@"
    return
  fi
  if has sudo; then
    sudo "$@"
    return
  fi
  die "stop-ollama-daemon: root or sudo required"
}

unit="ollama.service"
plist="/Library/LaunchDaemons/com.ollama.service.plist"

# Check if running
if ! "$script_dir/is-ollama-daemon-running" 2>/dev/null; then
  success "ollama daemon is not running"
  exit 0
fi

if has systemctl; then
  run_priv systemctl stop "$unit"
  success "ollama daemon stopped"
  exit 0
fi

if [ "$(uname -s 2>/dev/null)" = "Darwin" ] && has launchctl; then
  run_priv launchctl unload "$plist"
  success "ollama daemon stopped"
  exit 0
fi

die "stop-ollama-daemon: systemd or launchd required"
