#!/bin/sh

# Uninstall an LLM model.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: uninstall-llm MODEL

Removes an LLM model from ollama.

Example: uninstall-llm llama2:7b
USAGE
  exit 0
  ;;
esac

set -eu
. env-clear

script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd)

model=${1-}
if [ -z "$model" ]; then
  die 2 "uninstall-llm: MODEL required"
fi

# Check if ollama is installed
if ! "$script_dir/is-ai-component-installed" ollama 2>/dev/null; then
  die "uninstall-llm: ollama is not installed"
fi

# Get ollama binary
if has ollama; then
  ollama_bin="ollama"
elif [ -x "$HOME/.local/bin/ollama" ]; then
  ollama_bin="$HOME/.local/bin/ollama"
else
  die "uninstall-llm: ollama binary not found"
fi

say "Uninstalling LLM model: $model"
$ollama_bin rm "$model" || die "uninstall-llm: failed to uninstall $model"

success "LLM model uninstalled: $model"
