#!/bin/sh

# Select an LLM to install from available list.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: select-llm-to-install

Opens a menu to select and install an available LLM model.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu
. env-clear
. colors

if ! require menu "The select-llm-to-install needs the 'menu' command to present options."; then
  exit 1
fi

script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd)

# Catch Ctrl-C and TERM signal to exit cleanly
trap 'exit 130' INT
trap 'exit 0' TERM

# Get list of available LLMs
available_llms=$("$script_dir/list-available-llms" 2>/dev/null || echo "")

if [ -z "$available_llms" ]; then
  die "select-llm-to-install: no available LLMs found"
fi

# Build menu of available LLMs
set --
for llm in $available_llms; do
  set -- "$@" "$llm%install-llm \"$llm\" && kill -TERM \$PPID"
done

exit_label=$(exit-label)
set -- "$@" "${exit_label}%kill -TERM \$PPID"

menu "Select LLM to install:" "$@" || menu_status=$?
menu_status=${menu_status:-0}

if [ "$menu_status" -eq 130 ]; then
  printf 'ESC\n' >&2
  exit 0
fi
