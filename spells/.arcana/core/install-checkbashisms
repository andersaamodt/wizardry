#!/bin/sh

# Bootstrap spell: install the checkbashisms utility so verify-posix can detect non-POSIX shells.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: install-checkbashisms

Install the checkbashisms command with your system package manager if it's missing, supporting common Linux distributions and macOS.
USAGE
  exit 0
  ;;
esac

set -eu
force_install="${INSTALL_CHECKBASHISMS_FORCE_INSTALL-}"
has_checkbashisms=$(command -v checkbashisms >/dev/null 2>&1 && echo "yes" || echo "no")

if [ "$force_install" != "1" ] && [ "$has_checkbashisms" = "yes" ]; then
        printf '%s\n' "checkbashisms is already installed."
        exit 0
fi

install_checkbashisms_run_installer() {
        cmd=$1
        shift
        if command -v sudo >/dev/null 2>&1; then
                printf '  Trying: sudo %s %s\n' "$cmd" "$*" >&2
                sudo "$cmd" "$@"
        else
                printf '  Trying: %s %s\n' "$cmd" "$*" >&2
                "$cmd" "$@"
        fi
