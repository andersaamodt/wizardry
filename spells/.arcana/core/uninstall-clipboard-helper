#!/bin/sh
# Bootstrap spell: uninstalls the currently installed clipboard helper.


uninstall_clipboard_helper_usage() {
        cat <<'USAGE' >&2
Usage: uninstall-clipboard-helper

This spell uninstalls the currently installed clipboard helper.
USAGE
}

uninstall_clipboard_helper() {
case "${1-}" in
--help|--usage|-h)
        uninstall_clipboard_helper_usage
        return 0
        ;;
esac

require-wizardry || return 1


set -eu
. env-clear

SCRIPT_DIR=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)

# Detect which clipboard helper is installed (other than pbcopy which is built-in)
uninstall_clipboard_helper_detect_installed_helper() {
  if command -v xsel >/dev/null 2>&1; then
    printf 'xsel'
  elif command -v xclip >/dev/null 2>&1; then
    printf 'xclip'
  elif command -v wl-copy >/dev/null 2>&1; then
    printf 'wl-copy'
  else
    printf ''
  fi
}

uninstall_clipboard_helper() {
  installed=$(uninstall_clipboard_helper_detect_installed_helper)
  
  if [ -z "$installed" ]; then
    printf '%s\n' "No removable clipboard helper installed."
    return 0
  fi
  
  case "$installed" in
    xsel)
      "$SCRIPT_DIR/uninstall-xsel"
      ;;
    xclip)
      "$SCRIPT_DIR/uninstall-xclip"
      ;;
    wl-copy)
      "$SCRIPT_DIR/uninstall-wl-clipboard"
      ;;
    *)
      printf '%s\n' "Unknown clipboard helper: $installed" >&2
      return 1
      ;;
  esac
}

uninstall_clipboard_helper

}

# Load castable imp for direct execution
if true; then  # Always source castable, never use from PATH
  _d=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
  _r=$(cd "$_d" && while [ ! -d "spells/.imps" ] && [ "$(pwd)" != "/" ]; do cd ..; done; pwd)
  _i="${WIZARDRY_DIR:-${_r}}/spells/.imps/sys"
  [ -f "$_i/castable" ] && . "$_i/castable"
fi

castable "$@"