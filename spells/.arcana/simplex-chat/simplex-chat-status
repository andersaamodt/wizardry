#!/bin/sh

# Report installation and setup status for simplex-chat.

show_usage() {
        cat <<'USAGE' >&2
Usage: simplex-chat-status

Reports whether simplex-chat is installed and ready to use, highlighting missing configuration or errors.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

set -eu
. colors

# Older scripts expect GRAY, so mirror GREY when missing.
GRAY=${GRAY:-${GREY-}}

simplex_bin=${SIMPLEX_CHAT_BIN:-simplex-chat}
config_dir=${SIMPLEX_CHAT_CONFIG_DIR:-$HOME/.config/simplex-chat}
data_dir=${SIMPLEX_CHAT_DATA_DIR:-$HOME/.local/share/simplex-chat}

# Check simplex-chat installation and setup status
if ! command -v "$simplex_bin" >/dev/null 2>&1; then
  status="not installed"
  printf "%s%s%s\n" "$GRAY" "$status" "$RESET"
  exit 0
fi

if ! "$simplex_bin" --version >/dev/null 2>&1; then
  status="installed, error"
  printf "%s%s%s\n" "$RED" "$status" "$RESET"
  exit 0
fi

status="installed"
if [ ! -d "$config_dir" ] || [ ! -d "$data_dir" ]; then
  status="installed, needs setup"
fi

# Color output based on status
case "$status" in
  "installed")
    color=$GREEN
    ;;
  "installed, needs setup")
    color=$YELLOW
    ;;
  "not installed")
    color=$GRAY
    ;;
  *)
    color=$RED
    ;;
esac

printf "%s%s%s\n" "$color" "$status" "$RESET"
