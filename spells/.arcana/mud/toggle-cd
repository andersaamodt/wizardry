#!/bin/sh

# Toggle cd hook on/off using settings file

toggle_cd_usage() {
cat <<'USAGE'
Usage: toggle-cd

Turn the cd hook that runs 'look' after each directory change on or off.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        toggle_cd_usage
        exit 0
        ;;
esac

set -eu

# Settings file location
mud_dir="${SPELLBOOK_DIR:-${HOME:-~}/.spellbook}/.mud"
setting_file="$mud_dir/cd-look-enabled"

if [ -f "$setting_file" ]; then
        # Enabled, so disable it
        rm -f "$setting_file"
        printf '%s\n' "✓ cd hook disabled. Directory changes will no longer display room descriptions."
else
        # Disabled, so enable it
        # Create settings directory
        if ! mkdir -p "$mud_dir"; then
                printf '%s\n' "✗ Failed to create $mud_dir" >&2
                exit 1
        fi
        touch "$setting_file"
        printf '%s\n' "✓ cd hook enabled. Each directory change will now display the room description."
        printf '%s\n' ""
        printf '%s\n' "Note: Make sure the cd function is sourced in your shell:"
        printf '%s\n' "  Add this line to ~/.bashrc or ~/.zshrc:"
        printf '%s\n' "    . \$HOME/.wizardry/spells/.arcana/mud/cd"
fi
