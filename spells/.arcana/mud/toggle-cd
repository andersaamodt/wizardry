#!/bin/sh

# Toggle cd hook on/off using mud-config

toggle_cd_usage() {
cat <<'USAGE'
Usage: toggle-cd

Turn the cd hook that runs 'look' after each directory change on or off.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        toggle_cd_usage
        exit 0
        ;;
esac

set -eu

SCRIPT_DIR=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
MUD_CONFIG="$SCRIPT_DIR/mud-config"

if [ ! -x "$MUD_CONFIG" ]; then
        printf '%s\n' "Error: mud-config not found at '$MUD_CONFIG'." >&2
        exit 1
fi

# Toggle the feature and report state
new_state=$("$MUD_CONFIG" toggle cd-look)

if [ "$new_state" = "1" ]; then
        printf '%s\n' "✓ cd hook enabled. Each directory change will now display the room description."
        printf '%s\n' ""
        printf '%s\n' "Note: Make sure the cd function is sourced in your shell:"
        printf '%s\n' "  Add this line to ~/.bashrc or ~/.zshrc:"
        printf '%s\n' "    . \$HOME/.wizardry/spells/.arcana/mud/cd"
else
        printf '%s\n' "✓ cd hook disabled. Directory changes will no longer display room descriptions."
fi
