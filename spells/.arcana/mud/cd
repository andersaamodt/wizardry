#!/bin/sh

# The cd cantrip: source this file to enable the cd hook that runs 'look'.
# Toggle with: toggle-cd (manages ~/.spellbook/.mud/cd-look-enabled)

cd_usage() {
cat <<'USAGE'
Usage: Source this file in your shell rc file to enable the cd hook.

    . $HOME/.wizardry/spells/.arcana/mud/cd

Then use 'toggle-cd' to enable/disable the hook.

The hook runs 'look' after every successful directory change.
USAGE
}

# The cd override - checks setting before running look
cd() {
    command cd "$@" || return $?
    
    # Check if cd-look is enabled via settings file
    if [ -f "${SPELLBOOK_DIR:-$HOME/.spellbook}/.mud/cd-look-enabled" ] ||
       [ -f "${HOME:-}/.wizardry/.mud/cd-look-enabled" ]; then
        command -v look >/dev/null 2>&1 && look 2>/dev/null || true
    fi
}

# When run directly (not sourced), just show usage
case "${1-}" in
--help|--usage|-h|*)
    cd_usage
    ;;
esac
