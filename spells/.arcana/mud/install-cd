#!/bin/sh

# Install the cd hook that runs 'look' after directory changes.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: install-cd

Install the cd hook that runs 'look' after each directory change.
This adds the necessary source line to your shell RC file.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1

set -eu
. env-clear

# Enable cd hook in MUD configuration
# This sets cd-hook=1 in $SPELLBOOK_DIR/.mud
# invoke-wizardry will load the hook when this setting is enabled

spell_home=$(env-or SPELLBOOK_DIR "${HOME:-.}/.spellbook")
config_file="$spell_home/.mud"

# Ensure spellbook directory exists
if [ ! -d "$spell_home" ]; then
  mkdir -p "$spell_home" || {
    printf '%s\n' "install-cd: cannot create spellbook directory '$spell_home'" >&2
    exit 1
  }
fi

# Use config-set to enable cd hook
config-set "$config_file" "cd-hook" "1"

printf '%s\n' "CD hook enabled in MUD configuration."
printf '%s\n' "Restart your shell or run 'invoke-wizardry' to activate."
