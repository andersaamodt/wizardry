#!/bin/sh

# Synonym for jump-to-marker. Teleport to bookmarks set by mark-location.
# This spell must be sourced (not executed) because it changes the current directory.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: . jump-to-location [marker]

Teleport to a marker set with mark-location. Defaults to marker "1". Use "next" to cycle through all saved locations.
Note: This spell must be sourced (use '. jump-to-location') to affect your current shell.
USAGE
  exit 0
  ;;
esac

# Uncastable: Must be sourced, not executed
_jtl_sourced=0
if eval '[ -n "${ZSH_VERSION+x}" ]' 2>/dev/null; then
  case "${ZSH_EVAL_CONTEXT-}" in
    *:file) _jtl_sourced=1 ;;
  esac
else
  _jtl_base=${0##*/}
  case "$_jtl_base" in
    sh|dash|bash|zsh|ksh|mksh) _jtl_sourced=1 ;;
    jump-to-location) _jtl_sourced=0 ;;
    *) _jtl_sourced=1 ;;
  esac
fi

if [ "$_jtl_sourced" -eq 0 ]; then
  printf '%s\n' "jump-to-location: must be sourced, not executed" >&2
  printf '%s\n' "Usage: . jump-to-location [marker]" >&2
  exit 1
fi
unset _jtl_sourced _jtl_base

set -eu

# Find jump-to-marker spell
_wizardry_dir="${WIZARDRY_DIR:-${HOME}/.wizardry}"
_jump_to_marker_path=""

if [ -f "$_wizardry_dir/spells/translocation/jump-to-marker" ]; then
  _jump_to_marker_path="$_wizardry_dir/spells/translocation/jump-to-marker"
elif command -v jump-to-marker >/dev/null 2>&1; then
  _jump_to_marker_path=$(command -v jump-to-marker)
fi

if [ -z "$_jump_to_marker_path" ]; then
  printf '%s\n' "jump-to-location: jump-to-marker not found" >&2
  return 1 2>/dev/null || exit 1
fi

# Source jump-to-marker with all arguments
. "$_jump_to_marker_path" "$@"
