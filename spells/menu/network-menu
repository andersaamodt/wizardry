#!/bin/sh
# Network configuration menu - work in progress

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: . network-menu    OR    network menu    (via parse/gloss)

Displays network configuration options.

This spell must be sourced (not executed) to affect your current shell.
USAGE
  return 0 2>/dev/null || exit 0
  ;;
esac

# Uncastable pattern - detect if sourced
network_menu_sourced=0
if eval '[ -n "${ZSH_VERSION+x}" ]' 2>/dev/null; then
  case "${ZSH_EVAL_CONTEXT-}" in
    *:file) network_menu_sourced=1 ;;
  esac
else
  network_menu_base=${0##*/}
  case "$network_menu_base" in
    sh|dash|bash|zsh|ksh|mksh) network_menu_sourced=1 ;;
    network-menu) network_menu_sourced=0 ;;
    parse) network_menu_sourced=1 ;;  # Sourced via parse
    *) network_menu_sourced=1 ;;
  esac
fi

if [ "$network_menu_sourced" -eq 0 ]; then
  printf '%s\n' "This spell must be sourced. Use:  . network-menu  OR  network menu" >&2
  return 1 2>/dev/null || exit 1
fi
unset network_menu_sourced network_menu_base

set +e  # Permissive mode since we're in user's shell
set -u
. env-clear

require-command menu || return 1

trap 'return 0' INT TERM
exit_label=$(exit-label)
# Exit button kills this menu script via TERM signal
# Menu (child process) evals: kill -TERM $PPID → kills its parent (this script)
exit_item="${exit_label}%kill -TERM \$PPID"

menu "Network Menu:" \
  "Configure static IP%configure-static-ip" \
  "Configure DHCP%configure-dhcp" \
  "$exit_item" || menu_status=$?
menu_status=${menu_status:-0}

# ESC kills this menu script via TERM signal (same as Exit button)
# Direct kill: kill -TERM $$ → kills this script
if [ "$menu_status" -eq 130 ]; then
  printf 'ESC\n' >&2
  kill -TERM $$ 2>/dev/null || true
  return 0
fi

