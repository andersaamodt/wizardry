#!/bin/sh

# This spell sets the current player identity for MUD connections.
# The player name is stored in the MUD config directory.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: set-player <playername>

Set the current player identity for MUD connections. The player name is stored
in the MUD config directory and used by MUD spells that need player identity.

Player names must be 3-16 characters, start with a letter, and contain only
letters, digits, and underscores.
USAGE
  exit 0
  ;;
esac

set -eu

player="${1-}"

if [ -z "$player" ]; then
    usage-error "set-player" "player name required"
fi

# Validate player name
if ! validate-player-name "$player"; then
    exit 1
fi

# Store player name using config-set
spell_home="${SPELLBOOK_DIR:-$HOME/.spellbook}"
config_file="$spell_home/.mud"
mkdir -p "$spell_home"
touch "$config_file"
config-set "$config_file" "player" "$player"
printf '%s\n' "Player identity set to '$player'."
