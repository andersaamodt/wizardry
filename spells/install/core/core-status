#!/usr/bin/env sh

usage() {
        cat <<'USAGE' >&2
Usage: core-status

Reports whether wizardry's core prerequisites are installed, printing "ready" or a comma-separated list of missing commands.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        usage
        exit 0
        ;;
esac


# Report readiness of core prerequisites for wizardry.


set -eu
script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
# shellcheck source=/dev/null
. "$script_dir/install-core"

missing=""

while IFS=: read -r _ command_name _ _; do
  if command -v "$command_name" >/dev/null 2>&1; then
    continue
  fi

  if [ -z "$missing" ]; then
    missing=$command_name
  else
    missing="$missing, $command_name"
  fi
done <<EOF
$(core_dependencies)
EOF

if [ -z "$missing" ]; then
  echo "ready"
else
  printf '%s\n' "missing $missing"
fi
