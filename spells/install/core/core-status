#!/usr/bin/env sh

# Report readiness of core prerequisites for wizardry.

show_usage() {
  cat <<'USAGE'
Usage: core-status

Check and display the installation status of core wizardry prerequisites.
Reports the state of essential commands (installed vs missing).
USAGE
}

case "${1-}" in
--help|--usage|-h)
  show_usage
  exit 0
  ;;
esac

set -eu
script_dir=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
# shellcheck source=/dev/null
. "$script_dir/install-core"

missing=""

while IFS=: read -r _ command_name _ _; do
  if command -v "$command_name" >/dev/null 2>&1; then
    continue
  fi

  if [ -z "$missing" ]; then
    missing=$command_name
  else
    missing="$missing, $command_name"
  fi
done <<EOF
$(core_dependencies)
EOF

if [ -z "$missing" ]; then
  echo "ready"
else
  printf '%s\n' "missing $missing"
fi
