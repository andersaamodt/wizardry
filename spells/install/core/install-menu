#!/usr/bin/env sh
set -eu

SCRIPT_DIR=$(CDPATH= cd -- "$(dirname "$0")" && pwd -P)
ROOT_DIR=$(CDPATH= cd -- "$SCRIPT_DIR/../../.." && pwd -P)
INSTALL_DIR=${WIZARDRY_BIN_DIR:-$HOME/.local/bin}
COMMAND_NAME=menu
SOURCE_PATH="$ROOT_DIR/spells/cantrips/$COMMAND_NAME"

if [ ! -e "$SOURCE_PATH" ]; then
  printf '%s\n' "install-menu: missing source '$SOURCE_PATH'" >&2
  exit 1
fi

if command -v "$COMMAND_NAME" >/dev/null 2>&1 && [ ! -L "$INSTALL_DIR/$COMMAND_NAME" ]; then
  exit 0
fi

mkdir -p "$INSTALL_DIR"
ln -sf "$SOURCE_PATH" "$INSTALL_DIR/$COMMAND_NAME"
