#!/bin/sh

# This spell installs and starts the MUD. It is the MUD's main loop and installer script.

mud_main_loop(){
	trap 'if [ "$PWD" != "$prev_dir" ]; then echo "dir changed"; prev_dir="$PWD"; fi' DEBUG
	while true; do
		sleep 1
	done
#	prev_pwd=""
#  while true; do
#  	pwd="$PWD"
#  	echo $pwd
#	  if [ "$prev_pwd" != "$pwd" ]; then
#	  	prev_pwd="$pwd"
#	  	echo Working directory changed.
#	    read-magic description $pwd
#	  fi
#	  sleep 0.1
#	done
}

install_mud(){
  if grep -q "source ${BASH_SOURCE[0]}" ~/.bashrc; then
    echo "You have already memorized this spell"
  else
    echo "Do you wish to memorize this spell? (yes/no)"
    read -r answer
    if [ "$answer" == "yes" ]; then
      echo "source ${BASH_SOURCE[0]}" >> ~/.bashrc
      echo "Spell memorized in .bashrc, so the mud will always be active in the terminal."
    else
      echo "The mud will only run in this shell window."
    fi
  fi
}

#if [ "${BASH_SOURCE[0]}" = "$0" ]; then
    install_mud
    trap '' 2  # Traps the INT signal and does nothing with it
    mud_main_loop & # runs the function in background
    echo "MUD started" # message when script is run
#fi