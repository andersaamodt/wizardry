#!/bin/sh

# Launch a desktop app by name in a WebView (future: native WebView integration).

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: launch-app <app-name>

Launch a desktop app by name from the .apps directory.

Currently, this spell validates the app structure and prepares
the environment. Native WebView integration is planned.

Example:
  launch-app menu-app

See also: list-apps
USAGE
  exit 0
  ;;
esac

set -eu

app_name=${1-}

if [ -z "$app_name" ]; then
  printf '%s\n' "launch-app: requires app name" >&2
  printf '%s\n' "Try: launch-app --help" >&2
  exit 2
fi

# Use WIZARDRY_DIR from environment (set by invoke-wizardry)
wizardry_dir=${WIZARDRY_DIR:-$HOME/.wizardry}

if [ ! -d "$wizardry_dir" ]; then
  printf '%s\n' "launch-app: wizardry directory not found: $wizardry_dir" >&2
  exit 1
fi

apps_dir="$wizardry_dir/.apps"
app_path="$apps_dir/$app_name"

# Validate app exists and has required structure
if ! app-validate "$app_path"; then
  printf '%s\n' "launch-app: invalid app: $app_name" >&2
  exit 1
fi

# Prepare environment by sourcing invoke-wizardry (already done in login shell)
# The host binary would capture this environment at startup

# For now, just report success and show app path
printf '%s\n' "App validated: $app_name"
printf '%s\n' "App path: $app_path"
printf '%s\n' "Entry point: $app_path/index.html"
printf '%s\n' ""
printf '%s\n' "Note: Native WebView integration is planned for future releases."
printf '%s\n' "The app structure is ready for host binary integration."
