#!/bin/sh

display_menu(){
    echo "List of running processes:"
    ps -ax | awk '{print $5}' | tail -n +2 | nl -w 2 -s ') '
}

PS_NAMES=($(ps -ax | awk '{print $5}' | tail -n +2))

display_menu

if ! command -v ask_number >/dev/null 2>&1; then
    echo "ask_number spell is required to choose a process." >&2
    exit 1
fi

choice=$(ask_number "Enter the number of the process you want to kill:" 1 ${#PS_NAMES[@]})

pid=$(ps -ax | awk '{print $1 " " $5}' | grep "${PS_NAMES[choice - 1]}" | awk '{print $1}')
if [ -n "$pid" ]; then
    if ask_yn "Are you sure you want to kill process ${PS_NAMES[choice - 1]} with pid $pid"; then
        kill_cmd=${KILL_CMD:-kill}
        "$kill_cmd" "$pid"
        echo "Process $pid (${PS_NAMES[choice - 1]}) has been killed."
    fi
fi
