#!/bin/sh

# Mark a file or task as checked using extended attributes.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: check <file>

Mark a file or task as checked by setting its checked attribute to 1.
USAGE
  exit 0
  ;;
esac

set -eu
. env-clear

if [ -z "${1-}" ]; then
  printf '%s\n' "check: file path required" >&2
  exit 2
fi

file=$1

if [ ! -e "$file" ]; then
  printf '%s\n' "check: file not found: $file" >&2
  exit 1
fi

# Use enchant to set checked=1 (enchant will add "user." prefix automatically)
if enchant "$file" checked 1 >/dev/null 2>&1; then
  printf '%s\n' "Checked: $(basename "$file")"
  exit 0
else
  printf '%s\n' "check: failed to mark file as checked" >&2
  exit 1
fi
