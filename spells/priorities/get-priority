#!/bin/sh

# This spell retrieves the priority value of a file from its extended attributes.
# Use it to check the relative importance of files within a directory.

case "${1-}" in
--help|--usage|-h)
  cat << 'USAGE'
Usage: get-priority <file>

Read and print the priority extended attribute from a file, outputting the number if set.
USAGE
  exit 0
  ;;
esac

set -eu

# Ensure file argument is provided
if [ -z "${1-}" ]; then
  printf '%s\n' "get-priority: file path required" >&2
  exit 2
fi

file=$1

# Verify file exists
if [ ! -f "$file" ]; then
  printf '%s\n' "get-priority: file not found: $file" >&2
  exit 1
fi

# Read and print the priority
priority=$(read-magic "$file" priority 2>/dev/null || true)

# Handle error messages or empty values
case "$priority" in
  *Error*|'')
    exit 0
    ;;
  *)
    printf '%s\n' "$priority"
    ;;
esac
