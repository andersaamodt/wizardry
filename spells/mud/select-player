#!/bin/sh

# This spell displays a menu to select and set the current MUD player.
# Use it to switch between player identities from available SSH keys.

show_usage() {
        cat <<'USAGE'
Usage: select-player

Display an interactive menu of available player identities (from ~/.ssh/*.pub)
and set MUD_PLAYER to the selected player.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

set -eu

# check if the $MUD_PLAYER environment variable is set
if [ -z "${MUD_PLAYER-}" ]; then
    printf '%s\n' "MUD_PLAYER is not set."
else
    printf '%s\n' "MUD_PLAYER is currently set to $MUD_PLAYER"
fi

# Build menu options from player keys
options=""
for file in "$HOME"/.ssh/*.pub; do
    [ -f "$file" ] || continue
    player_name=$(basename "$file" ".pub")
    if [ -n "$options" ]; then
        options="$options \"$player_name%set-player $player_name\""
    else
        options="\"$player_name%set-player $player_name\""
    fi
done
options="$options \"Cancel%return\""

# Execute menu with options
eval "menu \"Choose your player:\" $options"
