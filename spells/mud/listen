#!/bin/sh
# Listen for magical happenings in the current room

show_usage() {
  cat <<'USAGE'
Usage: listen [--stop] [--dir <directory>]

Start listening for magical events in the current room.
Creates a background process that monitors for changes and plays sounds.

Options:
  --stop          Stop the listener for the current directory
  --dir <dir>     Listen to a specific directory instead of current
  --help, -h      Show this help message

When sourced into the shell (e.g., by the cd hook), starts/stops listening
based on the current directory.
USAGE
}

case "${1-}" in
--help|--usage|-h)
  show_usage
  # Detect if sourced
  if [ -n "${BASH_VERSION:-}" ]; then
    if [ "${BASH_SOURCE[0]}" != "${0}" ]; then
      return 0
    fi
  elif [ -n "${ZSH_VERSION:-}" ]; then
    if [ "${(%):-%x}" != "${0}" ]; then
      return 0
    fi
  fi
  exit 0
  ;;
esac

# Detect if sourced (runs in parent shell context) vs executed
if [ -n "${BASH_VERSION:-}" ]; then
    if [ "${BASH_SOURCE[0]}" != "${0}" ]; then
        # Sourced in bash
        return 0
    fi
elif [ -n "${ZSH_VERSION:-}" ]; then
    if [ "${(%):-%x}" != "${0}" ]; then
        # Sourced in zsh
        return 0
    fi
fi

# Not sourced, was executed directly
exit 0
