#!/bin/sh

# Charge your avatar with a shocking touch that damages the next thing you touch.

case "${1-}" in
--help|--usage|-h)
  cat <<'USAGE'
Usage: shocking-grasp

Enchant yourself with shocking grasp. The next file or object you touch takes 4 damage, then the effect dissipates.
USAGE
  exit 0
  ;;
esac

require-wizardry || exit 1
set -eu
. env-clear

spell_home=$(env-or SPELLBOOK_DIR "${HOME:-.}/.spellbook")
config_file="$spell_home/.mud"

# Get avatar path
avatar_path=$(config-get "$config_file" "avatar-path" 2>/dev/null || printf '')

if [ -z "$avatar_path" ] || [ ! -d "$avatar_path" ]; then
  printf '%s\n' "shocking-grasp: no avatar found. Enable the avatar system first." >&2
  exit 1
fi

# Enchant avatar with on-toucher effect
# Format: on_toucher=damage:4
enchant "$avatar_path" "on_toucher=damage:4" >/dev/null 2>&1 || {
  printf '%s\n' "shocking-grasp: failed to enchant avatar" >&2
  exit 1
}

printf '%s\n' "Your hands crackle with electrical energy."
exit 0
