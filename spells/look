#!/bin/sh

set -eu

SCRIPT_SOURCE=$0
case $SCRIPT_SOURCE in
*/*)
        SCRIPT_DIR=${SCRIPT_SOURCE%/*}
        ;;
*)
        SCRIPT_DIR=.
        ;;
esac
SCRIPT_DIR=$(cd "$SCRIPT_DIR" && pwd -P)

load_colors() {
        if [ -n "${LOOK_COLORS_PATH-}" ] && [ -f "$LOOK_COLORS_PATH" ]; then
                # shellcheck disable=SC1090
                . "$LOOK_COLORS_PATH"
                return 0
        fi
        if colors_path=$(command -v colors 2>/dev/null); then
                # shellcheck disable=SC1090
                . "$colors_path"
                return 0
        fi
        if [ -x "$SCRIPT_DIR/cantrips/colors" ]; then
                # shellcheck disable=SC1090
                . "$SCRIPT_DIR/cantrips/colors"
                return 0
        fi
        return 1
}

if ! load_colors; then
        BLUE=""
        BOLD=""
        RESET=""
fi

if ! command -v read-magic >/dev/null 2>&1; then
        printf '%s\n' "look: read-magic spell is missing." >&2
        exit 1
fi

path=${1:-$PWD}

name=$(read-magic "$path" name || true)
description=$(read-magic "$path" description || true)

missing_msg='Error: The attribute does not exist.'

if [ "$name" != "$missing_msg" ] || [ "$description" != "$missing_msg" ]; then
        if [ "$name" != "$missing_msg" ] && [ -n "$name" ]; then
                printf '%s%s%s%s\n' "$BLUE" "$BOLD" "$name" "$RESET"
        fi
        if [ "$description" != "$missing_msg" ] && [ -n "$description" ]; then
                printf '%s\n' "$description"
        fi
else
        printf '%s\n' "You look, but you don't see anything."
fi
