#!/bin/sh

# enable-service flips systemd's enable flag so units start automatically on
# boot. It prompts for a service name when invoked without arguments.

show_usage() {
        cat <<'USAGE' >&2
Usage: enable-service UNIT

Enables the given systemd service so it starts on boot, prompting for a unit when none is provided.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

set -eu

spell_name=$(basename "$0")

service_name=${1-}
if [ -z "$service_name" ]; then
        service_name=$(ask-text "Which service should I enable?")
fi
if [ -z "$service_name" ]; then
        printf '%s\n' "$spell_name: No service name supplied." >&2
        exit 1
fi

unit=$(normalize-unit "$service_name")
printf 'Enabling %s so it starts at boot...\n' "$unit"
run-systemctl enable "$unit"
printf '%s\n' "systemd enablement request submitted."
