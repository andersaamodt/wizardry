#!/bin/sh

# disable-service removes a unit from systemd's boot sequence.

show_usage() {
        cat <<'USAGE' >&2
Usage: disable-service UNIT

Stops the given systemd service from starting at boot, prompting for a unit name if one is not provided.
USAGE
}

case "${1-}" in
--help|--usage|-h)
        show_usage
        exit 0
        ;;
esac

set -eu

spell_name=$(basename "$0")

service_name=${1-}
if [ -z "$service_name" ]; then
        service_name=$(ask-text "Which service should I disable?")
fi
if [ -z "$service_name" ]; then
        printf '%s\n' "$spell_name: No service name supplied." >&2
        exit 1
fi

unit=$(normalize-unit "$service_name")
printf 'Disabling %s so it no longer starts at boot...\n' "$unit"
run-systemctl disable "$unit"
printf '%s\n' "systemd disable request submitted."
