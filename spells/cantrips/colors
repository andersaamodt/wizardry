#!/usr/bin/env sh

# This magical knowledge serves as a colorful palette of hues and shades,
# granting control over the appearance of the terminal.
# Use these variables to add color to your writing.
# Example: printf '%sError:%s An error message.\n' "${RED}" "${RESET}"
# This script contains all color codes in the POSIX standard.
# You must source this script with '. ./colors' (or an absolute path) to use it.

usage() {
        cat <<'USAGE'
Usage: colors (source)

Sources a palette of ANSI escape variables and wizardry theme accents so scripts can style output, gracefully disabling colour when the terminal cannot render it.
USAGE
}

# Only handle --help when run directly as a script, not when sourced
# When sourced, $0 is the parent script, not 'colors'
case "$0" in
*colors)
        case "${1-}" in
        --help|--usage|-h)
                usage
                exit 0
                ;;
        esac
        ;;
esac

# Record whether the terminal appears to support ANSI escape sequences so
# callers can disable colour-aware features when needed.

set -eu
WIZARDRY_COLORS_AVAILABLE=1

# Create the escape character in a POSIX-compliant way.
# This stores the actual escape character (ASCII 27) in the variable,
# so that printf '%s' "$COLOR" works correctly.
ESC=$(printf '\033')

# Reset all attributes to their default values.
RESET="${ESC}[0m"

# Colours.
BLACK="${ESC}[30m"
RED="${ESC}[31m"
GREEN="${ESC}[32m"
YELLOW="${ESC}[33m"
BLUE="${ESC}[34m"
PURPLE="${ESC}[35m"
CYAN="${ESC}[36m"
WHITE="${ESC}[37m" # Or is this default/white?
GREY="${ESC}[2m"

# Formatting.
BOLD="${ESC}[1m"
ITALICS="${ESC}[3m" #or 3?
UNDERLINED="${ESC}[4m"
BLINK="${ESC}[5m"
INVERT="${ESC}[7m"
STRIKE="${ESC}[9m" # Strikethrough

# Bright colours.
BRIGHT_BLACK="${ESC}[30;1m"
BRIGHT_RED="${ESC}[31;1m"
BRIGHT_GREEN="${ESC}[32;1m"
BRIGHT_YELLOW="${ESC}[33;1m"
BRIGHT_BLUE="${ESC}[34;1m"
BRIGHT_PURPLE="${ESC}[35;1m"
BRIGHT_CYAN="${ESC}[36;1m"
BRIGHT_WHITE="${ESC}[37;1m"

# Light colours (extended 16-color palette).
LIGHT_BLUE="${ESC}[94m"

# Background colours.
BG_BLACK="${ESC}[40m"
BG_RED="${ESC}[41m"
BG_GREEN="${ESC}[42m"
BG_YELLOW="${ESC}[43m"
BG_BLUE="${ESC}[44m"
BG_PURPLE="${ESC}[45m"
BG_CYAN="${ESC}[46m"
BG_WHITE="${ESC}[47m"

# Bright background colours.
BG_BRIGHT_BLACK="${ESC}[40;1m"
BG_BRIGHT_RED="${ESC}[41;1m"
BG_BRIGHT_GREEN="${ESC}[42;1m"
BG_BRIGHT_YELLOW="${ESC}[103m"
BG_BRIGHT_BLUE="${ESC}[104m"
BG_BRIGHT_PURPLE="${ESC}[105m"
BG_BRIGHT_CYAN="${ESC}[106m"
BG_BRIGHT_WHITE="${ESC}[107m"

# Semantic theme colours for consistent UI styling.
# Use these throughout wizardry spells for a unified look.
THEME_HIGHLIGHT="$CYAN"          # Menu highlight / selected item
THEME_MUTED="$GREY"              # Secondary text / commands on right side of menu
THEME_CUSTOM="$YELLOW"           # User-created spell names
THEME_SUCCESS="$GREEN"           # Success indicators
THEME_ERROR="$RED"               # Error indicators
THEME_HEADING="${GREEN}${BOLD}"  # Priority/heading highlight
THEME_DIVIDER="$GREY"            # Menu dividers

# MUD-specific colours for fantasy game elements.
MUD_LOCATION="${BLUE}${BOLD}"    # Location/room titles
MUD_TITLE="${LIGHT_BLUE}"        # Room title attribute (light blue)
MUD_DESCRIPTION="${WHITE}"       # Room/item descriptions
MUD_ITEM="${YELLOW}"             # Items and objects
MUD_HANDLE="${CYAN}"             # Player names/handles
MUD_SPELL="${PURPLE}"            # Spell names
MUD_MONSTER="${RED}"             # Monster/enemy names

# Allow the user or terminal capabilities to disable colour output entirely.
case ${NO_COLOR-} in
        '' ) : ;;
        # shellcheck source=/dev/null
        * ) . "$(command -v disable-palette)" ;;
esac

case ${TERM-} in
        ''|dumb|unknown)
                # shellcheck source=/dev/null
                . "$(command -v disable-palette)"
                ;;
        *)
                if command -v tput >/dev/null 2>&1; then
                        colors=$(tput colors 2>/dev/null || printf '')
                        case ${colors:-} in
                                ''|0|-*)
                                        # Disable palette for empty, zero, or negative values
                                        # (tput returns -1 when colors are not supported)
                                        # shellcheck source=/dev/null
                                        . "$(command -v disable-palette)"
                                        ;;
                        esac
                fi
                ;;
esac
