#!/bin/sh

# Read a single key press from the controlling terminal and report it in a
# descriptive form ("enter", "up", literal text, etc.).



# Use conditional strictness based on execution context
# See .github/CODE_POLICY_SET_EU.md for details

# Prefer preloaded imp functions (underscore form) when available.

# Resolve require-command location
# Use command -v to find require-command when preloaded as a function

# Capture raw bytes with dd; bail out immediately when it is missing.



# Helper to restore terminal and close file descriptor







# Configure canonical mode to wait for exactly one byte of input.
# CRITICAL: Always set terminal mode, even when KEEP_RAW=1, because previous
# calls may have changed min/time settings for escape sequence handling

# Read buffer if exists


# Determine if we should read extra bytes for escape sequences
# When had_buffer=1, we only read extra if the buffer contains a partial escape
# When had_buffer=0, we always read extra in case of escape sequences

# Allow escape sequences to provide additional bytes.
# Only adjust terminal timing if stty is available (skip_stty=0)

# Read any additional bytes from escape sequences
# This works in both real terminal (with timing) and test mode (without timing)






# Convert numeric byte values back to characters.





