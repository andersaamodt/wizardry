name: 139-210 Ubuntu gloss block bisect

on:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  ubuntu-gloss-blocks-35-38:
    name: 139-210 Ubuntu gloss blocks 35-38
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 35-38 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 35 && idx <= 38)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-39-42:
    name: 139-211 Ubuntu gloss blocks 39-42
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 39-42 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 39 && idx <= 42)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-43-46:
    name: 139-212 Ubuntu gloss blocks 43-46
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 43-46 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 43 && idx <= 46)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-47-51:
    name: 139-213 Ubuntu gloss blocks 47-51
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 47-51 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 47 && idx <= 51)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-35-36:
    name: 139-214 Ubuntu gloss blocks 35-36
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 35-36 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 35 && idx <= 36)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-37-38:
    name: 139-215 Ubuntu gloss blocks 37-38
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 37-38 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 37 && idx <= 38)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-39-40:
    name: 139-216 Ubuntu gloss blocks 39-40
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 39-40 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 39 && idx <= 40)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-41-42:
    name: 139-217 Ubuntu gloss blocks 41-42
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 41-42 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 41 && idx <= 42)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-43-44:
    name: 139-218 Ubuntu gloss blocks 43-44
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 43-44 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 43 && idx <= 44)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-45-46:
    name: 139-219 Ubuntu gloss blocks 45-46
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 45-46 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 45 && idx <= 46)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-47-48:
    name: 139-220 Ubuntu gloss blocks 47-48
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 47-48 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 47 && idx <= 48)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"

  ubuntu-gloss-blocks-49-51:
    name: 139-221 Ubuntu gloss blocks 49-51
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install xattr tooling
        run: sudo apt-get update && sudo apt-get install -y attr
      - name: Load blocks 49-51 and run banish
        run: |
          set +e
          ulimit -c unlimited || true
          (
            set -e
            . spells/.imps/sys/invoke-wizardry
            gloss_file=$(mktemp /tmp/wizardry-gloss.XXXXXX)
            gloss_trim=$(mktemp /tmp/wizardry-gloss-trim.XXXXXX)
            generate-glosses --output "$gloss_file"
            awk '
              BEGIN { idx=0; keep=0 }
              /^# First-word gloss/ {
                idx++
                keep = (idx >= 49 && idx <= 51)
              }
              keep { print }
            ' "$gloss_file" > "$gloss_trim"
            . "$gloss_trim"
            set -x
            banish 8 --only --no-tests --no-heal
          )
          status=$?
          if [ "$status" -eq 139 ]; then
            printf '%s\n' "subshell banish exited with code 139 (SIGSEGV)"
            printf '%s\n' "Last 50 dmesg lines (if available):"
            dmesg | tail -n 50 || true
          fi
          exit "$status"
